<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scroll Wall</title>
<style>
  :root{--ink:#e9eef6;--ink-d:#aeb7c8;--bg:#0d1117;--panel:#121722;--b:#1e2a43;--hi:#182035;--accent:#ff6fa1;--accent2:#90d5ff;--ok:#67e8a5;--fail:#ff7b7b;--radius:18px;--shadow:0 8px 30px rgba(0,0,0,.35), 0 1px 2px rgba(0,0,0,.25)}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 10% -20%, #1c2644 0%, transparent 70%),radial-gradient(1400px 700px at 110% -10%, #18213a 0%, transparent 75%),linear-gradient(#0b0f17,#0d1117 40%);color:var(--ink);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:980px;margin:auto;padding:28px 16px 80px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;font-weight:900;letter-spacing:.4px;font-size:clamp(28px,6vw,56px)}
  .sub{color:var(--ink-d)}
  .btn{appearance:none;border:1px solid #2a3552;background:#18223a;color:var(--ink);padding:14px 16px;border-radius:14px;font-weight:800;box-shadow:var(--shadow);cursor:pointer}
  .btn.primary{background:var(--accent);border-color:transparent;color:#081019}
  .btn.ghost{background:transparent}
  .toolbar{margin-top:14px;background:linear-gradient(#121722,#0f1420);border:1px solid var(--b);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;display:grid;gap:12px;grid-template-columns:1fr 1fr}
  @media(min-width:700px){.toolbar{grid-template-columns:1fr auto auto auto}}
  .count{display:flex;align-items:center;justify-content:center;padding:14px 16px;border-radius:14px;background:#0f1522;border:1px solid #1b2233;font-weight:900;min-width:92px}
  .help{grid-column:1/-1;color:var(--ink-d)}
  .grid{margin-top:18px;display:grid;gap:18px}
  @media(min-width:700px){.grid{grid-template-columns:1fr 1fr}}
  @media(min-width:1040px){.grid{grid-template-columns:1fr 1fr 1fr}}
  .card{position:relative;overflow:hidden;border-radius:22px;background:linear-gradient(#121a2a,#0f1624);border:1px solid #22304a;box-shadow:var(--shadow);touch-action:pan-y}
  .media{position:relative;aspect-ratio:3/4;background:#0b101a}
  .media img,.media video{width:100%;height:100%;object-fit:cover;display:block}
  .body{padding:14px 14px 18px}
  .title{font-weight:800;margin:0 0 6px}
  .meta{color:var(--ink-d);font-size:14px;margin-bottom:8px}
  .chips{display:flex;gap:10px;flex-wrap:wrap}
  .chip{font-size:13px;font-weight:800;padding:8px 10px;border-radius:12px;border:1px solid #2a3348;background:#151d2b;color:var(--ink)}
  .chip.link{cursor:pointer}
  .cta{display:flex;align-items:center;gap:10px;margin-top:10px}
  .star{width:48px;height:48px;border-radius:50%;display:grid;place-items:center;font-size:20px;background:#141d2b;border:1px solid #2a3348;color:#ffdd66;cursor:pointer}
  .dismiss{margin-left:auto}.dismiss .x{display:block;width:16px;height:16px;border-top:3px solid #9bb0c8;border-right:3px solid #9bb0c8;transform:rotate(45deg)}
  .dismiss .x:before{content:"";display:block;width:16px;height:16px;border-top:3px solid #9bb0c8;border-right:3px solid #9bb0c8;transform:rotate(90deg) translate(-3px,3px)}
  .tag{position:absolute;top:10px;right:10px;padding:6px 8px;border-radius:9px;font-size:12px;font-weight:900;display:none}
  .tag.like{background:rgba(103,232,165,.18);color:#b4ffd9;border:1px solid #2d6b54}
  .tag.nope{left:10px;right:auto;background:rgba(255,123,123,.18);color:#ffc1c1;border:1px solid #703b3b}
  .burst,.dust{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:140px;height:140px;border-radius:50%;mix-blend-mode:screen;opacity:0}
  .burst{background:radial-gradient(circle,#ffd86b 0%, rgba(255,216,107,0) 70%)}
  .dust{background:radial-gradient(circle,#ff7b7b 0%, rgba(255,123,123,0) 70%)}
  .ping{animation:pop .35s ease} @keyframes pop{0%{opacity:0;transform:translate(-50%,-50%) scale(.6)}60%{opacity:.9}100%{opacity:0;transform:translate(-50%,-50%) scale(1.25)}}
  .drawer{position:fixed;inset:0;background:rgba(5,8,12,.7);backdrop-filter:saturate(1.2) blur(8px);display:none;z-index:30}
  .drawer.on{display:block}
  .drawer .sheet{position:absolute;inset:0;max-width:980px;margin:auto;padding:20px 16px}
  .drawer .panel{background:linear-gradient(#111926,#0e1521);border:1px solid var(--b);border-radius:20px;padding:16px 16px 26px;box-shadow:var(--shadow)}
  .toprow{display:flex;align-items:center;justify-content:space-between;margin:6px 2px 14px}
  .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#2a354d;color:#ffe;border:1px solid #364363;padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);display:none;z-index:50}
  .toast.on{display:block}
  a{color:var(--accent2);text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Scroll Wall</h1>
      <div class="sub">Women ‚Ä¢ Models ‚Ä¢ Influencers ‚Ä¢ Actors (Reddit)</div>
    </div>
    <button id="openLiked" class="btn">Liked ‚≠ê</button>
  </header>

  <div class="toolbar">
    <button id="newBatch" class="btn ghost">New batch</button>
    <button id="loadMore" class="btn primary">Load more</button>
    <div id="counter" class="count">0/0</div>
    <button id="shuffle" class="btn">Shuffle üîÄ</button>
    <div class="help">Swipe a card ‚Äî <b>right to like</b>, <b>left to dismiss</b>. Videos & GIFs auto-play. NSFW is enabled.</div>
    <button id="troubleshoot" class="btn ghost" style="grid-column:1/-1">Troubleshoot ü©∫</button>
    <pre id="debug" class="help" style="white-space:pre-wrap;margin:0"></pre>
  </div>

  <div id="grid" class="grid"></div>
</div>

<!-- Liked drawer -->
<div id="drawer" class="drawer" aria-hidden="true">
  <div class="sheet">
    <div class="panel">
      <div class="toprow">
        <div style="display:flex;gap:10px;align-items:center"><div class="btn ghost">Liked ‚≠ê</div><button id="exportJson" class="btn ghost">Export JSON</button></div>
        <button id="closeLiked" class="btn">Close</button>
      </div>
      <div id="likedGrid" class="grid"></div>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
(() => {
/* ---------- config ---------- */
const MIRROR = 'https://r.jina.ai/http://www.reddit.com';
const TIME_RANGE = 'week';
const CHUNK_LIMIT = 40;
const BATCH_SIZE = 24;      // how many subs per batch
const TITLE_WORDS = 100;

/* names-only subreddits (adults) */
const NAME_SUBS = [
  'EmRata','kendalljenner','kyliejenner','DuaLipa','sabrinacarpenter','MadisonBeer','HaileyBieber','addisonraee','CharliDamelio',
  'BellaHadid','GigiHadid','KaiaGerber','SydneySweeney','AlexandraDaddario','AnaDeArmas','MargotRobbie','Zendaya',
  'EmmaWatson','NataliePortman','SalmaHayek','EmilyBlunt','JessicaAlba','AlisonBrie','HayleyAtwell','MeganFox',
  'ArianaGrande','TaylorSwift','GalGadot','AmberHeard','AnneHathaway','BrieLarson','ElizabethOlsen','KateBeckinsale',
  'OliviaMunn','OliviaWilde','EmmaStone','AlexaDemie','FlorencePugh','AnyaTaylorJoy','SaoirseRonan','SelenaGomez',
  'HaileeSteinfeld','CamilaMendes','VictoriaJustice','EmmaRoberts','BellaThorne','MadelainePetsch','KiernanShipka',
  'AlexandriaOcasioCortez','LilyCollins','LilyJames','EmmaMackey','NaomiScott','RachelMcAdams','PriyankaChopra',
  'SofiaVergara','EvaGreen','EvaMendes','BlakeLively','KeiraKnightley','NinaDobrev','CandiceSwanepoel',
  'BarbaraPalvin','AdrianaLima','MirandaKerr','SaraSampaio','TaylorHill','JosephineSkriver','KarlieKloss',
  'AlexandraStan','KaceyMusgraves','Halsey','BebeRexha','RitaOra','BeckyG','CamilaCabello','DemiLovato',
  'DojaCat','MayaHawke','CamilaMorrone','AnaDeArmas','JennaOrtega','AlexandraShipp','LanaDelRey',
  'RachelZegler','OliviaRodrigo','BillieEilish','CharithraChandran','MaitreyiRamakrishnan','YaraShahidi',
  'KelseaBallerini','SabrinaClaudio','LaurenJauregui','Normani','SZA','KaliUchis','Saweetie','IggyAzalea',
  'AshleyGraham','EmilyDiDonato','GizeleOliveira','WinnieHarlow','GabbieEpstein','SophieTurner','MaisieWilliams'
];

/* ---------- state ---------- */
let pool=[], shown=[], likes=loadLikes(), lastError='';
const ui = {
  grid: qs('#grid'), likedGrid: qs('#likedGrid'),
  count: qs('#counter'), dbg: qs('#debug'),
  toast: qs('#toast'), drawer: qs('#drawer')
};

/* ---------- helpers ---------- */
function qs(s,el=document){return el.querySelector(s)}
function escapeHtml(s){return (s||'').replace(/[&<>"]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]))}
function toast(msg,ms=1500){ui.toast.textContent=msg;ui.toast.classList.add('on');setTimeout(()=>ui.toast.classList.remove('on'),ms)}
function saveLikes(){localStorage.setItem('sw_likes',JSON.stringify(likes))}
function loadLikes(){try{return JSON.parse(localStorage.getItem('sw_likes')||'[]')}catch{return[]}}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function updateCount(){ui.count.textContent=`${shown.length}/${pool.length}`}

/* ---------- fetching ---------- */
async function fetchSub(sub){
  const url = `${MIRROR}/r/${encodeURIComponent(sub)}/top.json?t=${TIME_RANGE}&limit=100`;
  const r = await fetch(url,{headers:{'Accept':'application/json'}});
  if(!r.ok) throw new Error(`${r.status} ${r.statusText}`);
  return (await r.json()).data?.children?.map(x=>x.data)||[];
}

function normalize(raw){
  const out=[];
  for(const p of raw||[]){
    const nsfw=!!p.over_18, sub=p.subreddit||'', title=String(p.title||'').trim().slice(0,TITLE_WORDS);
    let kind=null,src=null;
    if(p.is_video && p.media?.reddit_video?.fallback_url){ kind='video'; src=p.media.reddit_video.fallback_url }
    else if(p.secure_media?.reddit_video?.fallback_url){ kind='video'; src=p.secure_media.reddit_video.fallback_url }
    else if(/\.(gif|gifv|mp4)$/i.test(p.url||'')){ kind=/\.gif$/i.test(p.url)?'gif':'video'; src=(p.url||'').replace('.gifv','.mp4') }
    else if(/\.(jpe?g|png|webp)$/i.test(p.url||'')){ kind='image'; src=p.url }
    else if(p.preview?.images?.[0]?.source?.url){ kind='image'; src=p.preview.images[0].source.url.replace(/&amp;/g,'&') }
    if(!kind||!src) continue;
    out.push({id:p.id,title,author:p.author,sub,nsfw,kind,src,permalink:`https://reddit.com${p.permalink||''}`});
  }
  return out;
}

function filterPeople(items){
  // names-only subs already strongly bias to people; still filter out obvious non-people words
  const bad=['landscape','sunset','building','car','cat','dog','animal','mountain','meme','art','street','house','architecture'];
  return items.filter(p=>!bad.some(w=>(p.title||'').toLowerCase().includes(w)));
}

/* ---------- cards ---------- */
function makeCard(post){
  const el=document.createElement('article'); el.className='card'; el.dataset.id=post.id;
  el.innerHTML=`
    <div class="tag like">LIKE ‚≠ê</div><div class="tag nope">NOPE</div>
    <div class="burst"></div><div class="dust"></div>
    <div class="media">${post.kind==='image'?`<img alt="" loading="lazy" src="${post.src}">`:`<video playsinline muted autoplay loop src="${post.src}"></video>`}</div>
    <div class="body">
      <h3 class="title">${escapeHtml(post.title)}</h3>
      <div class="meta">u/${escapeHtml(post.author)} ‚Ä¢ r/${escapeHtml(post.sub)} ${post.nsfw?'‚Ä¢ NSFW':''}</div>
      <div class="chips">
        <a class="chip link" href="${post.permalink}" target="_blank" rel="noopener">Reddit</a>
        <span class="chip">${post.nsfw?'NSFW':'SFW'}</span>
      </div>
      <div class="cta">
        <button class="star" title="Like">‚≠ê</button>
        <a class="chip link" href="${post.src}" target="_blank" rel="noopener">Open media</a>
        <button class="star dismiss" title="Dismiss"><span class="x"></span></button>
      </div>
    </div>`;
  // swipe
  attachSwipe(el,{onLike:()=>like(post,el),onNope:()=>dismiss(el)});
  el.querySelector('.star').onclick=()=>like(post,el);
  el.querySelector('.dismiss').onclick=()=>dismiss(el);
  return el;
}
function like(p,el){ if(!likes.some(x=>x.id===p.id)){likes.unshift(p);saveLikes()} burst(el.querySelector('.burst')); toast('Saved to Liked ‚≠ê',900); dismiss(el) }
function dismiss(el){ dust(el.querySelector('.dust')); el.style.transition='transform .18s ease,opacity .18s ease'; el.style.transform='translateX(-20px) scale(.98)'; el.style.opacity='.0'; setTimeout(()=>{el.remove();updateCount()},160) }
function burst(el){el.classList.remove('ping');void el.offsetWidth;el.classList.add('ping')}
function dust(el){el.classList.remove('ping');void el.offsetWidth;el.classList.add('ping')}
function attachSwipe(el,{onLike,onNope}){let sx=0,dx=0,act=false;const m=el.querySelector('.media'),like=el.querySelector('.tag.like'),nope=el.querySelector('.tag.nope');const start=x=>{act=true;sx=x;dx=0;like.style.display=nope.style.display='none'};const move=x=>{if(!act)return;dx=x-sx;el.style.transform=`translateX(${dx}px) rotate(${dx/40}deg)`;like.style.display=dx>18?'block':'none';nope.style.display=dx<-18?'block':'none'};const end=()=>{if(!act)return;act=false;el.style.transition='transform .18s ease';if(dx>80)onLike();else if(dx<-80)onNope();else{el.style.transform='';like.style.display=nope.style.display='none'};setTimeout(()=>el.style.transition='',180)};m.addEventListener('touchstart',e=>start(e.touches[0].clientX),{passive:true});m.addEventListener('touchmove',e=>move(e.touches[0].clientX),{passive:true});m.addEventListener('touchend',end);m.addEventListener('mousedown',e=>{e.preventDefault();start(e.clientX)});window.addEventListener('mousemove',e=>{if(act)move(e.clientX)});window.addEventListener('mouseup',end)}

/* ---------- actions ---------- */
qs('#openLiked').onclick=()=>{renderLiked();ui.drawer.classList.add('on');ui.drawer.setAttribute('aria-hidden','false')}
qs('#closeLiked').onclick=()=>{ui.drawer.classList.remove('on');ui.drawer.setAttribute('aria-hidden','true')}
qs('#exportJson').onclick=()=>{const b=new Blob([JSON.stringify(likes,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='liked.json';a.click();setTimeout(()=>URL.revokeObjectURL(a.href),1000)}
qs('#shuffle').onclick=()=>{pool=shuffle(pool);toast('Shuffled');}
qs('#newBatch').onclick=buildBatch;
qs('#loadMore').onclick=loadMore;
qs('#troubleshoot').onclick=showDebug;

function renderLiked(){
  ui.likedGrid.innerHTML='';
  likes.forEach(p=>ui.likedGrid.appendChild(makeCard(p)));
}

async function buildBatch(){
  ui.dbg.textContent=''; toast('Building a new batch‚Ä¶',900);
  pool=[]; shown=[]; updateCount(); ui.grid.innerHTML='';
  const subs = shuffle([...NAME_SUBS]).slice(0,BATCH_SIZE);
  let added=0;
  for(const s of subs){
    try{
      const raw = await fetchSub(s);
      const norm = filterPeople(normalize(raw));
      pool.push(...norm);
      added+=norm.length;
      if(pool.length>120) break;
      await nap(200); // be gentle to mirror; avoids 429
    }catch(e){ lastError = `/${s}: ${e.message}`; }
  }
  pool = dedupe(pool,'id');
  if(pool.length===0){ toast('No fresh posts. Tap again.',1500); }
  else{ toast(`Ready: ${pool.length} posts`); }
  updateCount();
}

function loadMore(){
  if(pool.length===0){ toast('No pool yet ‚Äî hit New batch',1200); return }
  const take = pool.splice(0, Math.min(CHUNK_LIMIT, pool.length));
  take.forEach(p=>{ const card=makeCard(p); ui.grid.appendChild(card); shown.push(p); });
  updateCount();
}

function showDebug(){
  const ua = navigator.userAgent;
  const msg = [
    `Online: ${navigator.onLine}`,
    `UA: ${ua}`,
    `Pool size: ${pool.length}, shown: ${shown.length}, likes: ${likes.length}`,
    `Last error: ${lastError || '(none)'}`,
  ].join('\n');
  ui.dbg.textContent = msg;
  toast('Troubleshoot opened');
}

/* utils */
function nap(ms){ return new Promise(r=>setTimeout(r,ms)) }
function dedupe(arr,key){const m=new Map();for(const x of arr){m.set(x[key],x)}return [...m.values()]}

/* boot */
buildBatch();

})();
</script>
</body>
</html>