<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scroll Wall · SFW Models</title>
<style>
  :root{
    --bg:#0e0f12; --ink:#e9eaf0; --ink-d:#aeb3c3;
    --accent:#ff77a9; --star:#ffd166;
    --card:#2a2f39; --panel:#20232b; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background:
      radial-gradient(1200px 600px at 20% -10%,#15171d 0%,transparent 60%),
      radial-gradient(900px 400px at 100% 0%,#101218 0%,transparent 70%),
      linear-gradient(180deg,#0d0f14 0%,#0c0d12 100%);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
  }
  header{padding:26px 18px 8px}
  h1{margin:0 0 6px; font-size:clamp(26px,5.4vw,42px)}
  .subtitle{margin:0 0 14px; color:var(--ink-d); font-weight:600}
  .controls{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    margin:0 18px 8px; padding:10px 12px; border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.15));
    border:1px solid rgba(255,255,255,.06); box-shadow:var(--shadow)
  }
  button{
    appearance:none; border:0; color:#111; background:var(--accent);
    font-weight:800; padding:10px 16px; border-radius:12px; letter-spacing:.2px; cursor:pointer
  }
  button:disabled{opacity:.6; cursor:not-allowed}
  .pill{padding:8px 12px; border-radius:999px; background:var(--panel); color:var(--ink); font-weight:700; border:1px solid rgba(255,255,255,.06)}
  .grid{columns:1; column-gap:14px; padding:14px 14px 90px}
  @media(min-width:740px){.grid{columns:2}}
  @media(min-width:1040px){.grid{columns:3}}
  .card{
    break-inside:avoid; display:block; background:var(--card); border-radius:18px;
    box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.06); margin:0 6px 14px; overflow:hidden; position:relative
  }
  .pol-top{padding:10px 14px 0; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0) 30%)}
  .title{font-weight:800; letter-spacing:.2px; font-size:15px}
  .sub{color:var(--ink-d); font-size:12px; margin-top:2px}
  .thumb{width:100%; display:block; background:#14161c; aspect-ratio:4/3; object-fit:cover}
  .skel{background:linear-gradient(90deg,#2a2e36 25%,#323743 37%,#2a2e36 63%); background-size:400% 100%; animation:shimmer 1.2s infinite}
  @keyframes shimmer{0%{background-position:0 0}100%{background-position:100% 0}}
  .pol-btm{padding:12px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.18)); display:flex; align-items:center; justify-content:space-between; gap:10px}
  .meta{font-size:12px; color:var(--ink-d); display:flex; gap:10px; align-items:center}
  .badge{font-weight:800; font-size:12px; color:#111; background:#63e6be; padding:6px 10px; border-radius:999px}
  .stars{display:flex; gap:4px}
  .star{width:22px; height:22px; cursor:pointer; filter:drop-shadow(0 1px 0 rgba(0,0,0,.6)); opacity:.85}
  .star svg{width:100%; height:100%}
  .star.filled svg path{fill:var(--star)}
  #status{position:fixed;left:12px;right:12px;bottom:12px;padding:10px 12px;border-radius:12px;background:#15171b;color:#cfd3dc;font:12px/1.4 ui-sans-serif;box-shadow:0 8px 30px rgba(0,0,0,.35);z-index:9999;display:none;white-space:pre-wrap;border:1px solid #394452}
  .empty{color:var(--ink-d); text-align:center; padding:40px 16px 90px}
</style>
</head>
<body>
  <header>
    <h1>Scroll Wall</h1>
    <p class="subtitle">SFW models & fashion (Reddit • Top this week). Rate with ⭐</p>
  </header>

  <div class="controls">
    <button id="more">Load more</button>
    <span class="pill" id="count">0/0</span>
    <span class="pill">Override: <code>?reddit=r/FashionModels,r/ModelPhotography</code></span>
  </div>

  <main id="grid" class="grid"></main>
  <p id="empty" class="empty" style="display:none">Nothing yet — tap <b>Load more</b>.</p>
  <div id="status"></div>

<script>
(() => {
  // --- Config (SFW-only subs) ---
  const DEFAULT_SUBS = [
    'FashionModels','ModelPhotography','RedCarpetFashion',
    'OldSchoolCool','StreetFashion','CelebFashion','itookapicture'
  ];
  const BATCH = 24;
  const BASE = 'https://r.jina.ai/http://www.reddit.com'; // CORS-friendly mirror
  const countEl = document.getElementById('count');
  const moreBtn = document.getElementById('more');
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  const status = document.getElementById('status');

  // ratings in localStorage
  const RATINGS_KEY = 'sw_sfw_ratings_v1';
  const ratings = loadRatings();

  let shown = 0, total = 0;
  const seen = new Set();
  const afterMap = new Map();

  function showStatus(msg, err=false){
    status.style.display='block';
    status.style.borderColor = err ? '#ff5c7a' : '#394452';
    status.textContent = '['+new Date().toLocaleTimeString()+'] ' + msg;
  }
  function loadRatings(){ try{return JSON.parse(localStorage.getItem(RATINGS_KEY)||'{}')}catch{return{}} }
  function saveRatings(){ localStorage.setItem(RATINGS_KEY, JSON.stringify(ratings)); }
  function fmtCount(){ countEl.textContent = `${shown}/${total}`; }
  function q(key){ return new URLSearchParams(location.search).get(key) || ''; }
  function parseOverride(){
    const p = q('reddit'); if(!p) return null;
    return p.split(',').map(s=>s.trim().replace(/^r\//i,'').replace(/^\//,'')).filter(Boolean);
  }
  function cleanUrl(u){ return (u||'').replace(/&amp;/g,'&'); }
  function isImg(u){ return /\.(jpg|jpeg|png|gif|webp)(\?|$)/i.test(u); }

  async function fetchSub(sub){
    const state = afterMap.get(sub);
    const after = state?.token ? `&after=${encodeURIComponent(state.token)}` : '';
    const url = `${BASE}/r/${sub}/top.json?t=week&limit=50&raw_json=1${after}`;
    showStatus('Fetching ' + sub);
    const res = await fetch(url, { cache:'no-store' });
    const txt = await res.text(); // mirror returns text
    const data = JSON.parse(txt);
    afterMap.set(sub, { token: data?.data?.after || null });
    return (data?.data?.children || []);
  }

  function extractImage(p){
    const d = p.data;
    // ignore NSFW by design (SFW-only build)
    if (d.over_18) return null;
    const preview = d.preview?.images?.[0]?.source?.url;
    const direct  = d.url_overridden_by_dest || d.url || '';
    const candidate = cleanUrl(preview || direct);
    if (candidate && (isImg(candidate) || candidate.startsWith('https://i.redd.it/'))) return candidate;
    return null;
  }

  function makeStars(id){
    const wrap = document.createElement('div'); wrap.className='stars';
    const cur = Number(ratings[id]||0);
    for(let i=1;i<=5;i++){
      const b = document.createElement('button'); b.className='star' + (i<=cur ? ' filled' : '');
      b.title = `${i} star${i>1?'s':''}`;
      b.innerHTML = `<svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.29 6.95 1.01-5.02 4.89 1.19 6.93L12 18.9l-6.21 3.26 1.19-6.93L1.96 9.3l6.95-1.01L12 2z" fill="rgba(255,255,255,.18)"/></svg>`;
      b.addEventListener('click', ()=>{
        ratings[id] = (ratings[id]===i) ? 0 : i;
        saveRatings();
        [...wrap.children].forEach((el,idx)=> el.classList.toggle('filled', idx < (ratings[id]||0)));
      });
      wrap.appendChild(b);
    }
    return wrap;
  }

  function cardFromPost(p){
    const d = p.data;
    const img = extractImage(p);
    if(!img) return null;
    if(seen.has(d.id)) return null;
    seen.add(d.id);

    const el = document.createElement('article');
    el.className = 'card';
    el.innerHTML = `
      <div class="pol-top">
        <div class="title">${(d.title||'').slice(0,120)}</div>
        <div class="sub">r/${d.subreddit} • u/${d.author}</div>
      </div>
      <img class="thumb skel" alt="${(d.title||'').replace(/"/g,'&quot;')}" />
      <div class="pol-btm">
        <div class="meta"><span class="badge">TOP</span><span>❤ ${d.ups ?? 0}</span></div>
        <div class="stars"></div>
      </div>
    `;
    const imgEl = el.querySelector('.thumb');
    imgEl.addEventListener('load', ()=> imgEl.classList.remove('skel'), { once:true });
    imgEl.src = img;

    el.querySelector('.stars').replaceWith(makeStars(d.id));
    return el;
  }

  async function loadBatch(){
    moreBtn.disabled = true;
    empty.style.display = 'none';
    const subs = parseOverride() || DEFAULT_SUBS;

    // pick a few subs to fetch to build one batch
    const picks = [];
    while (picks.length < Math.min(5, subs.length)) {
      const s = subs[picks.length]; // simple round-robin
      picks.push(s);
    }

    let added = 0, fetchedCount = 0;
    for (const sub of picks){
      try{
        const posts = await fetchSub(sub);
        fetchedCount += posts.length;
        for (const post of posts){
          const card = cardFromPost(post);
          if(!card) continue;
          grid.appendChild(card);
          shown++; added++;
          if(added >= BATCH) break;
        }
      } catch (e){
        showStatus(`Error fetching ${sub}: ${e.message}`, true);
      }
      if(added >= BATCH) break;
    }

    // update counters (rough)
    total = Math.max(total, shown + Math.max(0, fetchedCount - added));
    fmtCount();
    if (shown === 0) empty.style.display = 'block';
    moreBtn.disabled = false;
  }

  // kick off
  moreBtn.addEventListener('click', loadBatch);
  fmtCount();
  loadBatch(); // first batch
})();
</script>
</body>
</html>