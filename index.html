<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scroll Wall · Reddit</title>
<style>
  :root{--bg:#0f1013;--panel:#2f3136;--ink:#f5f5f5;--muted:#b9bcc4;--accent:#6cf;--radius:22px;--gap:18px;--shadow:0 8px 24px rgba(0,0,0,.25)}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Inter,Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;padding:14px 16px;background:linear-gradient(180deg,rgba(15,16,19,.92),rgba(15,16,19,.7),rgba(15,16,19,0));backdrop-filter:saturate(1.2) blur(8px);display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  header h1{margin:0;font-size:22px;font-weight:800}
  header .hint{color:var(--muted);font-weight:600}
  .wrap{max-width:1100px;margin:0 auto;padding:0 16px 80px}
  .controls{display:flex;gap:10px;align-items:center;margin:8px 2px 12px;flex-wrap:wrap}
  .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;color:#0b0c0f;background:var(--accent);cursor:pointer;box-shadow:var(--shadow)}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .grid{display:grid;gap:var(--gap);grid-template-columns:repeat(1,minmax(0,1fr))}
  @media(min-width:520px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media(min-width:880px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
  .card{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);min-height:180px;display:flex;flex-direction:column;gap:10px;overflow:hidden}
  .title{font-size:16px;font-weight:800}
  .meta{color:var(--muted);font-size:12px}
  .card img{width:100%;height:auto;border-radius:14px;background:#3a3b3f;display:block}
  .skeleton{height:12px;border-radius:999px;background:#3a3b3f;overflow:hidden}
  .skeleton::before{content:"";display:block;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent);animation:shimmer 1.25s infinite}
  @keyframes shimmer{from{transform:translateX(-100%)}to{transform:translateX(100%)}}
  #sentinel{height:1px}
  footer{color:var(--muted);text-align:center;margin-top:18px}
  .pill{background:#1f2328;border:1px solid #38414a;color:#cdd9e5;padding:6px 10px;border-radius:999px;font-size:12px}
</style>
</head>
<body>
<header class="wrap">
  <h1>Scroll Wall</h1>
  <span class="hint">Reddit feed · change subs in code or use <span class="pill">?reddit=r/pics,r/EarthPorn</span></span>
</header>

<main class="wrap">
  <div class="controls">
    <button id="moreBtn" class="btn">Load more</button>
    <span id="status" style="color:var(--muted);font-weight:600"></span>
  </div>
  <section id="grid" class="grid" aria-live="polite"></section>
  <div id="sentinel" aria-hidden="true"></div>
  <footer id="endMsg"></footer>
</main>

<script>
/* ---------- Config ---------- */
const DEFAULT_SUBS = ['r/pics','r/EarthPorn','r/wallpapers','r/CityPorn','r/itookapicture']; // edit me
const BATCH = 18;

/* ---------- State ---------- */
const grid = document.getElementById('grid');
const btn  = document.getElementById('moreBtn');
const sent = document.getElementById('sentinel');
const status = document.getElementById('status');
const endMsg = document.getElementById('endMsg');

let items = [];   // {title, desc, img, url}
let cursor = 0;

/* ---------- Helpers ---------- */
function q(key){ return new URLSearchParams(location.search).get(key) || ''; }
function sanitize(s=''){ return String(s).replace(/[<>]/g, m => ({'<':'&lt;','>':'&gt;'}[m])); }
function isImgUrl(u=''){ return /\.(jpg|jpeg|png|gif|webp)(\?|$)/i.test(u); }
function uniqBy(arr, keyFn){ const m=new Set(); return arr.filter(x=>{const k=keyFn(x); if(m.has(k)) return false; m.add(k); return true;}); }

/* ---------- Render ---------- */
function cardEl(item, i){
  const a = document.createElement('a');
  a.className = 'card';
  a.href = item.url; a.target = '_blank'; a.rel = 'noopener';
  a.innerHTML = `
    <div class="title">${sanitize(item.title || ('Item ' + (i+1)))}</div>
    <div class="meta">${sanitize(item.desc || '')}</div>
    ${item.img ? `<img loading="lazy" alt="${sanitize(item.title||'')}" src="${item.img}">`
               : `<div class="skeleton" style="height:150px;border-radius:14px"></div>`}
  `;
  return a;
}

function loadMore(){
  if (cursor >= items.length) return;
  const stop = Math.min(cursor + BATCH, items.length);
  for (let i = cursor; i < stop; i++) grid.appendChild(cardEl(items[i], i));
  cursor = stop;
  status.textContent = `${cursor}/${items.length}`;
  if (cursor >= items.length){
    observer.disconnect();
    sent?.remove();
    btn.disabled = true;
    btn.textContent = 'All loaded';
    endMsg.textContent = '• end •';
  }
}

/* ---------- Reddit fetch ---------- */
async function fetchReddit(subsCSV){
  const subs = subsCSV.split(',').map(s => s.trim()).filter(Boolean);
  let out = [];
  for (const sub of subs){
    const url = `https://www.reddit.com/${sub.replace(/^\/?/,'')}/hot.json?limit=50`;
    try {
      const r = await fetch(url, {cache:'no-store'});
      if (!r.ok) continue;
      const data = await r.json();
      const posts = (data?.data?.children || []).map(c => c.data).filter(Boolean);
      const mapped = posts
        .filter(p => !p.over_18) // skip NSFW
        .map(p => {
          const preview = p.preview?.images?.[0]?.source?.url;
          const direct  = p.url_overridden_by_dest || p.url || '';
          const img = (preview || direct).replace(/&amp;/g,'&');
          return {
            title: p.title,
            desc: `u/${p.author} • ${p.subreddit}`,
            img: isImgUrl(img) ? img : (p.thumbnail && isImgUrl(p.thumbnail) ? p.thumbnail : ''),
            url: `https://www.reddit.com${p.permalink}`
          };
        })
        .filter(x => x.img); // only keep items with a usable image
      out = out.concat(mapped);
    } catch {}
  }
  // de-dupe by URL
  return uniqBy(out, x => x.url);
}

/* ---------- Init ---------- */
const observer = new IntersectionObserver(
  (entries)=>{ if (entries.some(e=>e.isIntersecting)) loadMore(); },
  { root:null, rootMargin:'1400px 0px', threshold:0.01 }
);
btn.addEventListener('click', loadMore);

(async () => {
  // allow override via ?reddit=r/pics,r/wallpapers
  const param = q('reddit') || DEFAULT_SUBS.join(',');
  items = await fetchReddit(param);

  // fallback demo if nothing came back
  if (!items || items.length === 0){
    items = Array.from({length: 30}, (_,i)=>({ title:`Item ${i+1}`, desc:'(demo)' }));
  }

  status.textContent = `0/${items.length}`;
  observer.observe(sent);
  loadMore(); loadMore(); // prime two batches so it looks alive
})();
</script>
</body>
</html>