<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scroll Wall</title>
<style>
  :root{
    --bg:#0a0f1a;
    --bg2:#0f1624;
    --ink:#e9eefc;
    --muted:#9fb0d0;
    --accent:#ff6fa0;
    --chip:#223048;
    --chipInk:#d9e6ff;
    --polaroid:#fff;
    --shadow: 0 14px 40px rgba(0,0,0,.35), 0 3px 8px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background: radial-gradient(1200px 600px at 50% -200px,#142036 0%,#0b1220 60%,#0a0f1a 100%); color:var(--ink); font: 16px/1.4 ui-sans-serif,system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;}
  a{color:inherit}
  .wrap{max-width:960px;margin:0 auto;padding:24px 16px 80px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{margin:0;font-size:40px;letter-spacing:.5px}
  .btn{appearance:none;border:0;border-radius:16px;padding:14px 18px;font-weight:800;background:var(--accent);color:#111;box-shadow:var(--shadow);cursor:pointer}
  .btn.secondary{background:#1f2b44;color:var(--ink);box-shadow:none;border:1px solid #2a3a5a}
  .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  .counter{min-width:80px;text-align:center;border-radius:14px;padding:12px 14px;background:#13203a;border:1px solid #1d2c4c;font-weight:800}
  .likedBtn{background:#1c2741;color:var(--ink);border:1px solid #2a3a5a}
  .likedBtn .star{filter: drop-shadow(0 4px 8px rgba(0,0,0,.4));}
  .tips{margin:12px 0 6px;color:var(--muted)}

  /* Masonry-ish flow */
  .grid{columns: 1; column-gap: 16px}
  @media(min-width:640px){ .grid{columns: 2} }
  @media(min-width:980px){ .grid{columns: 3} }

  /* Polaroid card */
  .card{
    break-inside: avoid;
    display:block;
    margin:12px 0;
    padding:14px 14px 22px;
    background:var(--polaroid);
    color:#111;
    border-radius:14px;
    box-shadow: var(--shadow);
    transform: rotate(var(--rot, 0deg));
    position:relative;
    transition: transform .18s ease, box-shadow .18s ease, opacity .25s ease;
  }
  .card:hover{ box-shadow: 0 18px 50px rgba(0,0,0,.45) }
  .frame{
    width:100%; aspect-ratio: 4/5; /* classic polaroid portrait-ish */
    background:#ccc; border-radius:10px; overflow:hidden;
  }
  .frame img, .frame video{
    width:100%; height:100%; object-fit:cover; display:block;
  }
  .caption{
    margin-top:10px; display:flex; align-items:center; justify-content:space-between; gap:8px;
  }
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:999px;
    background:var(--chip); color:var(--chipInk); font-weight:700; letter-spacing:.2px;
  }
  .starBtn{
    position:absolute; left:12px; top:12px;
    width:42px; height:42px; border-radius:50%;
    display:grid; place-items:center; border:none; cursor:pointer;
    background:rgba(255,255,255,.9);
    box-shadow:0 8px 16px rgba(0,0,0,.35);
    transform:scale(1); transition:transform .08s ease;
  }
  .starBtn:active{ transform:scale(.9) }
  .star{ font-size:22px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.4)) }
  .badge{font-size:12px; font-weight:900; padding:4px 8px; border-radius:999px; background:#1e2b47; color:#cfe0ff; border:1px solid #2a3a5a}

  /* Like / dismiss animations */
  .likeBurst{ position:absolute; inset:0; pointer-events:none; }
  .burstDot{ position:absolute; width:8px; height:8px; border-radius:50%; background:#ffd74f; opacity:.9; transform:scale(0); animation:pop .6s ease forwards; }
  @keyframes pop{ to{ transform:translate(var(--tx),var(--ty)) scale(1); opacity:0 } }

  /* Liked drawer */
  .drawer{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; place-items:center; padding:20px; }
  .drawer.open{ display:grid }
  .panel{ width:min(900px, 92vw); max-height:88vh; overflow:auto; background:#0d1526; border:1px solid #283a62; border-radius:18px; padding:16px }
  .panel h2{ margin:0 0 8px }
  .x{ float:right }

  /* Toast */
  .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#2a1b1b; color:#ffdede; border:1px solid #613; border-radius:12px; padding:10px 14px; font-weight:700; display:none }
  .toast.show{ display:block }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Scroll Wall</h1>
      <button id="likedOpen" class="btn likedBtn"><span class="star">‚≠ê</span>&nbsp;Liked</button>
    </header>

    <div class="row" style="margin-bottom:14px">
      <button id="loadBtn" class="btn">Load more</button>
      <div id="count" class="counter">0/0</div>
      <button id="shuffleBtn" class="btn secondary">Shuffle üîÄ</button>
    </div>

    <div class="tips">Tap ‚≠ê to like. Swipe right = like, left = dismiss. Videos/GIFs auto-play.</div>

    <div id="grid" class="grid"></div>
  </div>

  <!-- Liked drawer -->
  <div id="likedDrawer" class="drawer" aria-hidden="true">
    <div class="panel">
      <button class="btn secondary x" id="likedClose">Close</button>
      <h2>Liked ‚≠ê</h2>
      <div id="likedGrid" class="grid"></div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
/* ----------------------- CONFIG ----------------------- */
const USE_MIRROR = true; // more reliable on mobile (CORS/rate-limit)
const FETCH_BASE = USE_MIRROR
  ? 'https://r.jina.ai/http://www.reddit.com'
  : 'https://www.reddit.com';

// A lean, women-only list (models / influencers / actors).
// You can add/remove easily; the app randomly picks.
const WOMEN_SUBS = [
  'EmilyRatajkowski','AlexisRen','MadisonBeer','DuaLipa','EmmaWatson','AnaDeArmas',
  'SydneySweeney','EizaGonzalez','SabrinaCarpenter','Zendaya','TaylorHill','BarbaraPalvin',
  'AlexandraDaddario','MargotRobbie','GalGadot','EmmaStone','HaileeSteinfeld','CamilaMorrone',
  'CharliDAmelio','AddisonRae','HaileyBieber','LilyCollins','AnyaTaylorJoy','JennaOrtega',
  'ElizabethOlsen','FlorencePugh','ArianaGrande','KylieJenner','KendallJenner','BellaHadid',
  'GigiHadid','KaiaGerber','LanaDelRey','MeganFox','DojaCat','OliviaRodrigo',
  'AlexandraStan','LeaElui','SommerRay','KatherineLangford','AlexandraShipp','SofiaVergara',
  'SalmaHayek','EmmaMackey','LilyJames','AnaCheri','AlishaLehmann','K-pop','winterAESPA'
].map(s => `r/${s}`); // make them look nice in chip, we‚Äôll strip r/ when needed

const BATCH_SIZE = 10;       // how many cards per load
const MAX_CARDS  = 150;      // memory guard
/* ------------------------------------------------------ */

let pool = [];            // unseen posts
let shown = 0;            // shown count
let liked = loadLiked();  // [{id, media, sub, isVideo}]
let lastError = null;

const grid = document.getElementById('grid');
const likedGrid = document.getElementById('likedGrid');
const loadBtn = document.getElementById('loadBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const countEl = document.getElementById('count');
const likedOpen = document.getElementById('likedOpen');
const likedClose = document.getElementById('likedClose');
const likedDrawer = document.getElementById('likedDrawer');
const toast = document.getElementById('toast');

updateCount();
renderLikedButton();

/* ----------------------- EVENTS ----------------------- */
window.addEventListener('load', async () => {
  await buildBatch();
  appendFromPool(BATCH_SIZE);
  observeScroll();
});

loadBtn.addEventListener('click', () => appendFromPool(BATCH_SIZE));
shuffleBtn.addEventListener('click', async () => {
  await buildBatch(true); // force new picks
  appendFromPool(BATCH_SIZE);
});

likedOpen.addEventListener('click', () => { openLiked(); });
likedClose.addEventListener('click', () => { closeLiked(); });

/* --------------------- CORE LOGIC --------------------- */
async function buildBatch(force=false){
  // Refill pool only if low or shuffle pressed
  if (!force && pool.length > 20) return;

  pool = []; // reset so we actually change content
  const picks = shuffle([...WOMEN_SUBS]).slice(0, 14); // small mix each time
  await Promise.all(picks.map(fetchSub));
  // de-dupe by post id
  const seen = new Set();
  pool = pool.filter(p => !seen.has(p.id) && seen.add(p.id));
  if (!pool.length) showToast('No fresh posts. Tap Load more again.');
}

async function fetchSub(sub){
  try{
    const subname = sub.replace(/^r\//,'');
    const tries = [
      `${FETCH_BASE}/r/${encodeURIComponent(subname)}/top.json?limit=25&t=week&raw_json=1`,
      `${FETCH_BASE}/r/${encodeURIComponent(subname)}/hot.json?limit=25&raw_json=1`,
      `${FETCH_BASE}/r/${encodeURIComponent(subname)}/top.json?limit=25&t=day&raw_json=1`,
    ];
    for (const url of tries){
      const r = await fetch(url, {headers:{'Accept':'application/json'}});
      if (!r.ok) { lastError = `Fetch ${subname}: ${r.status}`; continue; }
      const json = await r.json();
      const items = (json.data?.children || [])
        .map(n => n.data)
        .filter(d => !d.stickied && !d.removed_by_category && !d.is_gallery)
        .map(d => toPost(d, subname))
        .filter(Boolean);
      if (items.length){ pool.push(...items); return; }
    }
  }catch(e){ lastError = e.message; }
}

function toPost(d, subname){
  // prefer direct media; fall back to preview images
  const isVid = !!(d.is_video && d.media?.reddit_video?.fallback_url);
  let media = null;
  if (isVid){
    media = d.media.reddit_video.fallback_url;
  }else{
    media = d.url_overridden_by_dest || d.url || null;
    if (!/\.(jpg|jpeg|png|gif|mp4|webm)$/i.test(media||'')) {
      // try preview
      const p = d.preview?.images?.[0]?.source?.url?.replace(/&amp;/g,'&');
      if (p) media = p;
    }
  }
  if (!media) return null;
  return {
    id: d.id,
    sub: subname,
    media,
    isVideo: isVid || /\.(mp4|webm)$/i.test(media),
    over18: !!d.over_18
  };
}

function appendFromPool(n){
  if (!pool.length){ showToast('No fresh posts. Tap Load more again.'); return; }
  const take = pool.splice(0, n);
  for (const p of take){
    const el = cardEl(p);
    grid.appendChild(el);
    shown++;
  }
  updateCount();
  // memory guard
  if (grid.childElementCount > MAX_CARDS){
    for (let i=0; i<20; i++) grid.removeChild(grid.firstElementChild);
  }
}

function cardEl(p){
  const card = document.createElement('article');
  card.className = 'card';
  card.style.setProperty('--rot', `${(Math.random()*2-1.2).toFixed(2)}deg`);

  const frame = document.createElement('div');
  frame.className = 'frame';

  if (p.isVideo){
    const v = document.createElement('video');
    v.src = p.media; v.muted = true; v.playsInline = true; v.autoplay = true; v.loop = true;
    frame.appendChild(v);
  }else{
    const img = document.createElement('img');
    img.loading = "lazy";
    img.src = p.media;
    frame.appendChild(img);
  }

  const star = document.createElement('button');
  star.className = 'starBtn';
  star.setAttribute('aria-label','Like');
  star.innerHTML = '<span class="star">‚≠ê</span>';
  star.addEventListener('click', (e)=>{ e.stopPropagation(); like(p, card); });

  // Swipe gestures
  let startX=0, dx=0;
  card.addEventListener('pointerdown', e=>{ startX=e.clientX; card.setPointerCapture(e.pointerId); });
  card.addEventListener('pointermove', e=>{
    if(!startX) return;
    dx = e.clientX - startX;
    card.style.transform = `rotate(var(--rot)) translateX(${dx}px)`;
    card.style.opacity = String(Math.max(0.4, 1-Math.abs(dx)/300));
  });
  card.addEventListener('pointerup', ()=>finishSwipe());
  card.addEventListener('pointercancel', ()=>finishSwipe());
  function finishSwipe(){
    if(!startX) return;
    const swipedRight = dx > 80;
    const swipedLeft  = dx < -80;
    card.style.opacity = '1';
    card.style.transform = `rotate(var(--rot)) translateX(0)`;
    startX=0; dx=0;
    if (swipedRight) like(p, card);
    else if (swipedLeft) dismiss(card);
  }

  const cap = document.createElement('div');
  cap.className = 'caption';
  const chip = document.createElement('span');
  chip.className = 'chip';
  chip.textContent = `r/${p.sub}`;
  const badge = document.createElement('span');
  badge.className = 'badge';
  badge.textContent = p.over18 ? 'NSFW' : 'SFW';
  cap.append(chip, badge);

  const burst = document.createElement('div');
  burst.className = 'likeBurst';

  card.append(star, frame, cap, burst);
  return card;
}

function like(p, card){
  if (!liked.find(x => x.id===p.id)){
    liked.unshift(p);
    saveLiked();
    renderLikedButton();
  }
  animateLike(card);
  // remove card from DOM
  card.style.transform = 'translateY(8px) scale(.98)';
  card.style.opacity = '.0';
  setTimeout(()=> card.remove(), 120);
}
function dismiss(card){
  card.style.transform = 'translateY(8px) scale(.98)';
  card.style.opacity = '.0';
  setTimeout(()=> card.remove(), 120);
}
function animateLike(card){
  const burst = card.querySelector('.likeBurst');
  burst.innerHTML = '';
  for(let i=0;i<18;i++){
    const d=document.createElement('div');
    d.className='burstDot';
    const a=(Math.PI*2)*Math.random(), r= (80+60*Math.random());
    d.style.setProperty('--tx', `${Math.cos(a)*r}px`);
    d.style.setProperty('--ty', `${Math.sin(a)*r}px`);
    d.style.left='50%'; d.style.top='50%';
    burst.appendChild(d);
  }
}

function updateCount(){
  const total = grid.childElementCount;
  countEl.textContent = `${Math.min(shown,total)}/${total}`;
}
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'), 2000);
}

/* ------------------- LIKED DRAWER -------------------- */
function openLiked(){
  likedGrid.innerHTML = '';
  liked.forEach(p => likedGrid.appendChild(cardEl(p)));
  likedDrawer.classList.add('open');
  likedDrawer.setAttribute('aria-hidden','false');
}
function closeLiked(){
  likedDrawer.classList.remove('open');
  likedDrawer.setAttribute('aria-hidden','true');
}
function renderLikedButton(){
  likedOpen.innerHTML = `<span class="star">‚≠ê</span>&nbsp;Liked (${liked.length})`;
}
function saveLiked(){ localStorage.setItem('scrollwall_likes', JSON.stringify(liked.slice(0,300))); }
function loadLiked(){ try{ return JSON.parse(localStorage.getItem('scrollwall_likes')||'[]'); }catch{ return []; } }

/* ------------------ INFINITE SCROLL ------------------ */
function observeScroll(){
  let ticking=false;
  window.addEventListener('scroll', ()=>{
    if(ticking) return; ticking=true;
    requestAnimationFrame(async ()=>{
      ticking=false;
      const nearBottom = (window.innerHeight + window.scrollY) > (document.body.offsetHeight - 800);
      if (nearBottom){
        if (pool.length < BATCH_SIZE) await buildBatch();
        appendFromPool(BATCH_SIZE);
      }
    });
  });
}

/* ---------------------- UTILS ------------------------ */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
</script>
</body>
</html>