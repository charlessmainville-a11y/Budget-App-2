<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Celeb Wall • v2.2</title>
<style>
  body { margin:0; font-family:sans-serif; background:#0f0f0f; color:#eee; }
  header, footer { display:flex; padding:8px; justify-content:center; gap:12px; background:#1a1a1a; position:sticky; top:0; z-index:10; }
  .btn { background:#333; color:#eee; padding:6px 12px; border-radius:6px; cursor:pointer; user-select:none; }
  .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px; padding:16px; }
  .card { background:#222; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,.3); display:flex; flex-direction:column; }
  .frame { position:relative; aspect-ratio:4/5; background:#111; }
  .frame img,.frame video { width:100%; height:100%; object-fit:cover; }
  .meta { padding:10px; border-top:1px solid #333; }
  .titleRow { display:flex; justify-content:space-between; margin-bottom:6px; }
  .person { font-weight:bold; font-size:1.05rem; }
  .source { font-size:.9rem; color:#aaa; }
  .actions { display:flex; gap:10px; margin-top:6px; }
  .rectBtn { flex:1; padding:.6rem; border-radius:8px; border:none; font-weight:bold; cursor:pointer; }
  .bad { background:#401c23; color:#ffc5cc; }
  .good{ background:#12372a; color:#b3ffe9; }
</style>
</head>
<body>
<header>
  <div class="btn" id="btnHome">Home</div>
  <div class="btn" id="btnLikes">⭐ Likes</div>
  <div class="btn" id="btnNew">New Batch</div>
  <div class="btn" id="btnLoad">Load More</div>
  <div class="btn" id="btnShuffle">Shuffle</div>
</header>

<div id="cards" class="grid"></div>

<footer>
  <div class="btn">Shown <span id="shown">0</span></div>
  <div class="btn">Pool <span id="pool">0</span></div>
  <div class="btn">Total <span id="total">0</span></div>
</footer>

<script>
let pool=[], shown=0, total=0, view='home';
let likes=JSON.parse(localStorage.getItem('likes_v1')||'[]');
let hidden=new Set(JSON.parse(localStorage.getItem('hidden_v1')||'[]'));
const cardsEl=document.getElementById('cards');
const shownEl=document.getElementById('shown');
const poolEl=document.getElementById('pool');
const totalEl=document.getElementById('total');

const LIMIT_PER_QUERY = 100;
const NAMES_PER_BATCH = 20;

const PEOPLE=[
 "Charli D'Amelio","Lea Elui","Kendall Jenner","Hailey Bieber","Madison Beer","Sabrina Carpenter","Sydney Sweeney",
 "Dua Lipa","Gal Gadot","Alexandra Daddario","Ana de Armas","Selena Gomez","Kaia Gerber","Vanessa Hudgens",
 "Margot Robbie","Emily Ratajkowski","Irina Shayk","Emma Watson","Ariana Grande","Bella Hadid","Gigi Hadid",
 "Zendaya","Natalie Portman","Megan Fox","Addison Rae","Kylie Jenner","Kim Kardashian","Kourtney Kardashian",
 "Khloe Kardashian","Sophie Turner","Maisie Williams","Florence Pugh","Rachel McAdams","Jessica Alba",
 "Scarlett Johansson","Jennifer Lawrence","Emma Stone","Kristen Stewart","Mila Kunis","Blake Lively","Taylor Swift",
 "Olivia Rodrigo","Billie Eilish","Doja Cat","Halsey","Megan Thee Stallion","Cardi B","Nicki Minaj","Rihanna",
 "Shakira","Selma Blair","Salma Hayek","Eva Mendes","Eva Longoria","Jennifer Lopez","Jessica Biel","Miranda Kerr",
 "Candice Swanepoel","Adriana Lima","Alessandra Ambrosio","Barbara Palvin","Rosie Huntington-Whiteley","Karlie Kloss",
 "Bella Thorne","Vanessa Morgan","Lucy Hale","Lili Reinhart","Camila Mendes","Madelaine Petsch","Ariel Winter",
 "Sofia Vergara","Nina Dobrev","Victoria Justice","Elizabeth Gillies","Hilary Duff","Ashley Benson","Shay Mitchell",
 "Troian Bellisario","Lucy Boynton","Anya Taylor-Joy","Elle Fanning","Dakota Fanning","Kiernan Shipka","Chloe Moretz",
 "Hailee Steinfeld","Zoe Kravitz","Janelle Monae","Lana Del Rey","Kacey Musgraves","Maren Morris","Kelly Clarkson",
 "Christina Aguilera","Britney Spears","Mandy Moore","Avril Lavigne","Katy Perry","Jessie J","Rita Ora","Fergie"
];

const SUBS=['celebs','CelebrityPhotos','ModelPhotos'];

function updateMeters(){ shownEl.textContent=shown; poolEl.textContent=pool.length; totalEl.textContent=shown+pool.length; }
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function clean(u){ return typeof u==='string'?u.replace(/&amp;/g,'&'):u; }
function toMP4(u){ if(!u) return null; if(/\.gifv($|\?)/i.test(u)) return u.replace(/\.gifv/i,'.mp4'); return u; }
function pickVideo(d){ const rv=d?.secure_media?.reddit_video||d?.media?.reddit_video; return rv?.fallback_url||null; }
function extractPreview(d){ return d?.preview?.images?.[0]?.source?.url?clean(d.preview.images[0].source.url):null; }
function bestMedia(d){ const direct=clean(d.url_overridden_by_dest||d.url); const vid=pickVideo(d); if(vid) return {url:vid,kind:'video'}; let u=toMP4(direct); if(u&&/\.(jpg|jpeg|png|gif|mp4)$/i.test(u)) return {url:u,kind:/\.mp4$/i.test(u)?'video':'image'}; const prev=extractPreview(d); if(prev) return {url:toMP4(prev),kind:'image'}; return null; }

async function fetchNameFromSub(name,sub){
  const url=`https://www.reddit.com/r/${sub}/search.json?restrict_sr=1&sort=new&limit=${LIMIT_PER_QUERY}&q=title:${encodeURIComponent(name)}&include_over_18=on&raw_json=1`;
  try{
    const res=await fetch(url); if(!res.ok) return 0;
    const data=await res.json(); const kids=data?.data?.children||[]; let added=0;
    for(const c of kids){
      const d=c.data||{}; const pick=bestMedia(d); if(!pick?.url) continue;
      const id=d.permalink?`https://reddit.com${d.permalink}`:`${sub}|${d.title||name}`;
      if(hidden.has(id)) continue;
      pool.push({id,person:name,title:d.title||name,url:pick.url,kind:pick.kind,source:`r/${sub}`});
      added++;
    }
    return added;
  }catch(e){ return 0; }
}

async function buildNewBatch(){
  view='home'; cardsEl.innerHTML=''; shown=0; pool=[]; updateMeters();
  const names=shuffleArray([...PEOPLE]).slice(0,NAMES_PER_BATCH);
  for(const sub of SUBS){ for(const n of names){ await fetchNameFromSub(n,sub); await sleep(150); } }
  shuffleArray(pool); total=pool.length; updateMeters(); renderMore();
}

function renderCard(item){
  const card=document.createElement('div'); card.className='card';
  const frame=document.createElement('div'); frame.className='frame';
  if(item.kind==='video'){const v=document.createElement('video'); v.src=item.url; v.autoplay=true; v.loop=true; v.muted=true; v.playsInline=true; frame.appendChild(v);}
  else{const img=document.createElement('img'); img.src=item.url; frame.appendChild(img);}
  const meta=document.createElement('div'); meta.className='meta';
  const titleRow=document.createElement('div'); titleRow.className='titleRow';
  const person=document.createElement('div'); person.className='person'; person.textContent=item.person;
  const source=document.createElement('div'); source.className='source'; source.textContent=item.source;
  titleRow.append(person,source);
  const actions=document.createElement('div'); actions.className='actions';
  const btnNope=document.createElement('button'); btnNope.className='rectBtn bad'; btnNope.textContent='Dismiss';
  const btnLike=document.createElement('button'); btnLike.className='rectBtn good'; btnLike.textContent='Like';
  btnNope.onclick=()=>{hidden.add(item.id); localStorage.setItem('hidden_v1',JSON.stringify([...hidden])); card.remove();};
  btnLike.onclick=()=>{likes.unshift(item); localStorage.setItem('likes_v1',JSON.stringify(likes.slice(0,500))); card.remove();};
  actions.append(btnNope,btnLike);
  meta.append(titleRow,actions);
  card.append(frame,meta);
  return card;
}

function renderMore(n=12){
  if(view!=='home') return;
  let c=0; while(c<n&&pool.length){ cardsEl.appendChild(renderCard(pool.shift())); shown++; c++; }
  updateMeters();
}

function showLikes(){ view='likes'; cardsEl.innerHTML=''; shown=likes.length; pool=[]; updateMeters(); likes.forEach(it=>cardsEl.appendChild(renderCard(it))); }
function showHome(){ view='home'; cardsEl.innerHTML=''; shown=0; updateMeters(); renderMore(); }

function shuffleFeed(){
  if(view==='likes'){ likes=shuffleArray(likes); showLikes(); return; }
  const nodes=Array.from(cardsEl.children);
  shuffleArray(nodes); cardsEl.innerHTML=''; nodes.forEach(n=>cardsEl.appendChild(n));
  pool=shuffleArray(pool);
}

document.getElementById('btnNew').onclick=buildNewBatch;
document.getElementById('btnLoad').onclick=()=>renderMore();
document.getElementById('btnLikes').onclick=showLikes;
document.getElementById('btnHome').onclick=showHome;
document.getElementById('btnShuffle').onclick=shuffleFeed;

buildNewBatch();
</script>
</body>
</html>