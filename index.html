<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scroll Wall ‚Ä¢ Build v5.3</title>
<style>
  :root{
    --bg:#0e1217; --bg2:#10151c; --ink:#e8eef6; --muted:#9fb0c2;
    --rose:#ff6fa3; --rose-2:#ff4f92; --panel:#1a2230; --accent:#89f0ff;
    --ok:#79ffa6; --warn:#ffd479; --bad:#ff7a7a; --shadow:rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:radial-gradient(1200px 500px at 50% -200px,#182132,#0e1217 60%), var(--bg);
            color:var(--ink); font:600 16px/1.45 ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;}
  .wrap{max-width:880px;margin:28px auto 100px; padding:0 14px;}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btn{background:linear-gradient(180deg,#ff7fb3,#ff5e9f); color:#081018;
       padding:14px 20px;border-radius:16px; border:0; font-weight:800; letter-spacing:.2px;
       box-shadow:0 10px 24px -8px var(--shadow); cursor:pointer; transition:.2s transform}
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn.alt{background:linear-gradient(180deg,#212a3a,#141b27); color:var(--ink); border:1px solid #2a3547}
  .pill{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:16px;
        background:linear-gradient(180deg,#182131,#121824); border:1px solid #263248; color:var(--ink)}
  .muted{color:var(--muted)}
  .badge{display:inline-block; padding:4px 9px; border-radius:10px; font-weight:800; background:#1c2533; color:var(--accent); border:1px solid #263248}
  .card{position:relative; background:radial-gradient(140% 100% at 50% -30%,#1b2536,#111722);
        border:1px solid #25334a; border-radius:26px; box-shadow:0 20px 60px -20px var(--shadow);
        overflow:hidden; margin:18px 0; isolation:isolate}
  .polaroid{padding:16px 16px 12px; background:
        radial-gradient(180px 80px at 50% -30px, #26314880, transparent),
        linear-gradient(180deg, #20293a 0%, #141b27 100%);}
  .ph{display:block;width:100%;height:auto;border-radius:16px;object-fit:cover;background:#0b0f15}
  .vid{width:100%;max-height:70vh;border-radius:16px;background:#0b0f15}
  .meta{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:12px}
  .src{font-weight:800;color:#d7e6ff;background:#1b2536;border:1px solid #293650;border-radius:12px;padding:8px 12px}
  .act{display:flex; gap:10px}
  .star,.nope{width:52px;height:52px;border-radius:16px;border:0;cursor:pointer;
              background:linear-gradient(180deg,#ff8ab9,#ff5aa1); color:#091018; font-size:22px; box-shadow:0 12px 30px -12px var(--shadow)}
  .nope{background:linear-gradient(180deg,#2a3345,#151c29); color:#ffb9c9; border:1px solid #2b3951}
  .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%); padding:12px 16px;border-radius:12px;background:#22161b;color:#ffdbe3;border:1px solid #4a2732;box-shadow:0 12px 30px -12px var(--shadow);opacity:0;transition:.25s}
  .toast.show{opacity:1}
  /* top bar */
  .top{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:10px}
  .build{opacity:.85}
  .dash{background:linear-gradient(180deg,#182131,#121824); border:1px dashed #2d3a50; padding:16px;border-radius:16px}
  .counter{min-width:84px;justify-content:center}
  /* modal */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(5,8,12,.65);backdrop-filter:blur(8px);z-index:50}
  .modal.show{display:grid}
  .sheet{width:min(720px,92vw); max-height:80vh; overflow:auto; border-radius:20px;
         background:linear-gradient(180deg,#172034,#121824); border:1px solid #2a354a; padding:16px}
  .sheet h3{margin:6px 0 10px}
  pre{white-space:pre-wrap; font:600 14px/1.4 ui-monospace,SFMono-Regular,Menlo,monospace; color:#dfeaff}
  a.link{color:#a2e5ff; text-decoration:none}
</style>
</head>
<body>
<div class="wrap">

  <div class="top">
    <div class="row">
      <button class="pill alt" id="homeBtn">Home</button>
      <button class="pill alt" id="likedBtn">Liked ‚≠ê <span class="badge" id="likedCount">0</span></button>
      <button class="pill alt" id="tsBtn">Troubleshoot ü©∫</button>
    </div>
    <div class="pill alt build">NSFW enabled ‚Ä¢ people-only ‚Ä¢ <b>Build v5.3</b></div>
  </div>

  <div class="dash">
    <div class="row" style="justify-content:space-between;gap:12px">
      <div class="row" style="gap:12px">
        <button class="btn alt" id="newBatchBtn">New batch</button>
        <button class="btn" id="loadMoreBtn">Load more</button>
      </div>
      <div class="row">
        <div class="pill alt counter" id="counter">0/0</div>
        <button class="pill alt" id="shuffleBtn">Shuffle üîÄ</button>
      </div>
    </div>
    <div id="status" class="muted" style="margin-top:12px">Tap <b>New batch</b> to build a pool.</div>
  </div>

  <div id="feed"></div>
</div>

<!-- Liked modal -->
<div class="modal" id="likedModal">
  <div class="sheet">
    <div class="row" style="justify-content:space-between">
      <h3>Liked ‚≠ê</h3>
      <button class="btn" id="closeLiked">Close</button>
    </div>
    <div id="likedList"></div>
  </div>
</div>

<!-- Troubleshoot modal -->
<div class="modal" id="tsModal">
  <div class="sheet">
    <div class="row" style="justify-content:space-between">
      <h3>Troubleshoot</h3>
      <button class="btn" id="closeTs">Close</button>
    </div>
    <pre id="tsPre"></pre>
  </div>
</div>

<div class="toast" id="toast">Saved</div>

<script>
/* =========================
   ONE THING TO EDIT ‚Üì‚Üì‚Üì
   ========================= */
const PROXY_URL = "https://YOURWORKER.workers.dev"; // ‚Üê change to your Worker root
/* The UI will call: `${PROXY_URL}/redgifs?q=<name>` and expects:
   { items: [{ url: "https://‚Ä¶mp4", poster: "https://‚Ä¶jpg", title:"‚Ä¶", source:"RedGifs" }] }
*/

/* ========= base state ========= */
const S = {
  pool: [], shown: 0, likes: loadLikes(), log: [],
  people: [
    // put highest-priority names first (you asked for Charli, Lea, Kendall on top)
    "Charli D'Amelio","Lea Elui","Kendall Jenner","Hailey Bieber","Madison Beer","Sabrina Carpenter",
    "Addison Rae","Sydney Sweeney","Gigi Hadid","Bella Hadid","Dua Lipa","Ana de Armas","Sommer Ray",
    "Alexis Ren","Barbara Palvin","Emily Ratajkowski","Elsa Hosk","Candice Swanepoel","Irina Shayk",
    "Lais Ribeiro","Taylor Hill","Josephine Skriver","Karlie Kloss","Camila Cabello","Doja Cat",
    "Megan Thee Stallion","Kylie Jenner","Kim Kardashian","Lana Rhoades","Alexandra Daddario",
    "Emma Watson","Jenna Ortega","Mia Khalifa","Megan Fox","Tate McRae","Olivia Rodrigo",
    "Lily-Rose Depp","Madelyn Cline","Alexis Texas","Pia Wurtzbach","Paige Spiranac",
    "Chantel Jeffries","Sommer Isabella","Yovanna Ventura","Lottie Moss","Sofia Richie",
    "Natalia Barulich","Lindsey Pelas","Carmella Rose","Zita d'Hauteville",
    "Renee Herbert","Elisha Herbert","Viki Odintcova","Nata Lee","Anllela Sagra",
    "Bruna Marquezine","Negin Mirsalehi","Tammy Hembrow","Abigail Ratchford",
    "Neelam Gill","Winnie Harlow","Ashanti","Halsey","Becky G","Tinashe",
    "Simi Khadra","Hana Cross","Karrueche Tran","Leomie Anderson","Devon Lee Carlson",
    "Aimee Lou Wood","Kaia Gerber","Amelia Gray","Maddy Burciaga","Haley Kalil",
    "Sof√≠a Vergara","Salma Hayek","Ana Cheri","Sommer Sheppard","Madi Monroe",
    "Loren Gray","Avani Gregg","Dixie D'Amelio","Meredith Mickelson","Delilah Belle",
    "Nina Agdal","Shanina Shaik","Georgia Fowler","Malu Trevejo","Eva Elfie",
    "Jordyn Woods","Lexi Rivera","Piper Rockelle","Alissa Violet","Leomie Anderson",
    "Tana Mongeau","Corinna Kopf","Amouranth","Syd Wilder","Brittany Renner"
  ],
  spicy: ["bikini","lingerie","photoshoot","red carpet","beach","behind the scenes"]
};

/* ========= helpers ========= */
const $ = sel => document.querySelector(sel);
const feed = $("#feed"), counter = $("#counter"), statusEl = $("#status");
const likedModal = $("#likedModal"), likedList = $("#likedList"), likedCount = $("#likedCount");
const tsModal = $("#tsModal"), tsPre = $("#tsPre"), toast = $("#toast");
function showToast(msg){ toast.textContent = msg; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),1200); }
function pushLog(line){ const stamp = new Date().toLocaleTimeString(); S.log.unshift(`[${stamp}] ${line}`); if (S.log.length>80) S.log.length=80; }
function saveLikes(){ localStorage.setItem("scrollwall.likes", JSON.stringify(S.likes)); likedCount.textContent = S.likes.length; }
function loadLikes(){ try{ return JSON.parse(localStorage.getItem("scrollwall.likes")||"[]"); }catch{ return []; }}

/* ========= UI actions ========= */
$("#homeBtn").onclick = () => window.scrollTo({top:0, behavior:"smooth"});
$("#likedBtn").onclick = renderLiked;
$("#closeLiked").onclick = () => likedModal.classList.remove("show");
$("#tsBtn").onclick = openTroubleshoot;
$("#closeTs").onclick = () => tsModal.classList.remove("show");
$("#shuffleBtn").onclick = () => { shuffle(S.pool); S.shown=0; feed.innerHTML=""; updateCounter(); pushLog("Pool shuffled"); showToast("Shuffled"); };
$("#newBatchBtn").onclick = buildNewBatch;
$("#loadMoreBtn").onclick = loadMore;

function updateCounter(){ counter.textContent = `${S.shown}/${S.pool.length}`; likedCount.textContent = S.likes.length; }

/* ========= core ========= */
async function buildNewBatch(){
  statusEl.textContent = "Building a new batch‚Ä¶";
  S.pool = []; S.shown = 0; feed.innerHTML = ""; updateCounter();

  // choose 24 random people, biasing top names higher
  const picks = weightedPick(S.people, 24);
  for (const name of picks){
    const q = `${name} ${randOf(S.spicy)}`;
    const items = await fetchRedgifs(q);
    if (items.length){
      // keep 1‚Äì2 per name to reduce duplicates
      const n = Math.min(2, items.length);
      S.pool.push(...items.slice(0,n).map(x => ({...x, tag:name})));
      pushLog(`${name}: +${n}`);
      await nap(220); // gentle pacing
    }else{
      pushLog(`${name}: none`);
      await nap(120);
    }
  }
  if (S.pool.length===0){
    statusEl.textContent = "No fresh posts. Tap New batch again.";
  }else{
    shuffle(S.pool);
    statusEl.textContent = `Ready. Pool size: ${S.pool.length}. Tap Load more.`;
  }
  updateCounter();
}

function loadMore(){
  if (S.shown >= S.pool.length){ statusEl.textContent = "Nothing else in this batch ‚Äî tap New batch."; return; }
  const take = Math.min(4, S.pool.length - S.shown);
  for (let i=0;i<take;i++){
    const item = S.pool[S.shown++];
    feed.appendChild(renderCard(item));
  }
  updateCounter();
}

/* ========= fetch from Worker ========= */
async function fetchRedgifs(query){
  try{
    const url = `${PROXY_URL}/redgifs?q=${encodeURIComponent(query)}`;
    const res = await fetch(url, {cache:"no-store"});
    if (!res.ok){ pushLog(`HTTP ${res.status} for ${query}`); return []; }
    const data = await res.json();
    const items = Array.isArray(data.items) ? data.items : [];
    // normalize
    return items
      .filter(x => x && x.url)
      .map(x => ({
        type: "video",
        url: x.url,
        poster: x.poster || "",
        title: x.title || query,
        source: x.source || "RedGifs"
      }));
  }catch(e){
    pushLog(`Fetch error for ${query}: ${e.message}`);
    return [];
  }
}

/* ========= render ========= */
function renderCard(item){
  const card = document.createElement("article");
  card.className = "card polaroid";
  // media
  let media;
  if (item.type==="video"){
    media = document.createElement("video");
    media.className = "vid"; media.controls=false; media.autoplay=true; media.muted=true; media.loop=true; media.playsInline=true;
    if (item.poster) media.poster=item.poster;
    const src = document.createElement("source");
    src.src = item.url; src.type="video/mp4";
    media.appendChild(src);
  }else{
    media = document.createElement("img");
    media.className="ph"; media.loading="lazy"; media.src=item.url; media.alt=item.title||"";
  }
  card.appendChild(media);

  // meta & actions
  const meta = document.createElement("div"); meta.className="meta";
  const left = document.createElement("div");
  left.innerHTML = `<span class="src">${item.source}</span>`;
  const act = document.createElement("div"); act.className="act";
  const like = document.createElement("button"); like.className="star"; like.title="Like"; like.textContent="‚≠ê";
  const nope = document.createElement("button"); nope.className="nope"; nope.title="Dismiss"; nope.textContent="üëé";
  act.append(like,nope); meta.append(left,act); card.appendChild(meta);

  // interactions
  let removed=false;
  function removeCard(){ if(removed) return; removed=true; card.style.opacity=.0; card.style.transform="translateY(6px) scale(.98)"; setTimeout(()=>card.remove(),180); }
  like.onclick = () => { S.likes.unshift(item); saveLikes(); glow(card); showToast("Saved to Liked"); };
  nope.onclick = removeCard;

  // swipe gestures
  let sx, sy;
  card.addEventListener("touchstart", e=>{ sx=e.touches[0].clientX; sy=e.touches[0].clientY; },{passive:true});
  card.addEventListener("touchend", e=>{
    const dx = (e.changedTouches[0].clientX - sx)|0;
    const dy = (e.changedTouches[0].clientY - sy)|0;
    if (Math.abs(dx) > 40 && Math.abs(dy) < 60){
      if (dx>0){ S.likes.unshift(item); saveLikes(); glow(card); }
      else removeCard();
    }
  });

  return card;
}
function glow(el){ el.animate([{boxShadow:"0 0 0 0 rgba(255,255,255,0)"},{boxShadow:"0 0 0 12px rgba(255,255,255,.04)"}],{duration:420,iterations:1}); }

/* ========= liked ========= */
function renderLiked(){
  likedList.innerHTML = "";
  if (!S.likes.length){
    likedList.innerHTML = `<div class="muted">Nothing liked yet.</div>`;
  }else{
    for (const it of S.likes){
      const card = document.createElement("article"); card.className="card polaroid";
      if (it.type==="video"){
        const v=document.createElement("video"); v.className="vid"; v.controls=true; v.autoplay=false; v.loop=true; v.muted=true; if(it.poster) v.poster=it.poster;
        const s=document.createElement("source"); s.type="video/mp4"; s.src=it.url; v.appendChild(s); card.appendChild(v);
      }else{
        const img=document.createElement("img"); img.className="ph"; img.src=it.url; img.alt=it.title||""; card.appendChild(img);
      }
      const meta=document.createElement("div"); meta.className="meta";
      const left=document.createElement("div"); left.innerHTML=`<span class="src">${it.source}</span>`;
      const act=document.createElement("div"); act.className="act";
      const del=document.createElement("button"); del.className="nope"; del.textContent="üóëÔ∏è"; del.title="Remove from Liked";
      del.onclick=()=>{ S.likes = S.likes.filter(x=>x!==it); saveLikes(); renderLiked(); };
      act.append(del); meta.append(left,act); card.appendChild(meta);
      likedList.appendChild(card);
    }
  }
  likedModal.classList.add("show");
}

/* ========= troubleshoot ========= */
function openTroubleshoot(){
  const ua = navigator.userAgent;
  const body = [
    `Online: ${navigator.onLine}`,
    `UA: ${ua}`,
    `Pool size: ${S.pool.length}, shown: ${S.shown}, likes: ${S.likes.length}`,
    `Last lines:\n${S.log.slice(0,12).join("\n") || "(none)"}`
  ].join("\n");
  tsPre.textContent = body;
  tsModal.classList.add("show");
}

/* ========= utils ========= */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } return a; }
function randOf(a){ return a[(Math.random()*a.length)|0]; }
function nap(ms){ return new Promise(r=>setTimeout(r,ms)); }
function weightedPick(list, n){
  // bias earlier names higher probability
  const out=[]; const weights=list.map((_,i)=>1/(1+i*0.06)); // gentle decay
  const sum=weights.reduce((a,b)=>a+b,0);
  while(out.length<n){
    let r=Math.random()*sum, idx=0;
    for(let i=0;i<list.length;i++){ r-=weights[i]; if(r<=0){ idx=i; break; } }
    if(!out.includes(list[idx])) out.push(list[idx]);
  }
  return out;
}

/* ========= boot ========= */
saveLikes(); // refresh header count
pushLog("UI ready. Tap New batch.");
</script>
</body>
</html>