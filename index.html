<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scroll Wall • Models & Influencers</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #111;
      color: #eee;
    }
    header {
      padding: 1rem;
      text-align: center;
    }
    h1 { margin: 0; font-size: 1.8rem; }
    h2 { margin: 0.2rem 0 0; font-weight: 400; font-size: 1rem; color: #aaa; }
    #controls {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      margin: 1rem;
      background: #1c1c1c;
      padding: 1rem;
      border-radius: 12px;
    }
    button {
      background: hotpink;
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.2rem;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
    }
    #gallery {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    .card {
      background: #222;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      transition: transform 0.3s ease;
    }
    .card img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain; /* full image fits */
      max-height: 70vh;
      background: #000;
    }
    .meta {
      padding: 0.8rem;
    }
    .actions {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0.8rem;
    }
    .actions button {
      background: none;
      color: #eee;
      font-size: 1rem;
      cursor: pointer;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <h1>Scroll Wall</h1>
    <h2>Models • Influencers • Actors (Reddit). Rate with ⭐</h2>
  </header>

  <div id="controls">
    <button id="loadBtn">Load more</button>
    <div>
      <label><input type="checkbox" id="nsfwToggle" checked /> Allow NSFW</label>
    </div>
    <div>
      <label>Override: <input id="override" placeholder="e.g. reddit=r/FashionModels" /></label>
    </div>
    <small id="status">Nothing yet — tap Load more.</small>
  </div>

  <div id="gallery"></div>

  <script>
    /** CONFIG **/
    const Curated = [
      "FashionModels","ModelPhotography","ModelsSFW","ModelShots",
      "Celebs","HighResCelebs","LadyBoners","RedCarpet",
      "FemaleFashionAdvice","HauteCouture","Lookbook"
    ];
    const BATCH = 12;
    const TIME_RANGE = "week";
    const STORAGE_KEY = "scrollwall_likes_v2";

    const gallery = document.getElementById("gallery");
    const status = document.getElementById("status");
    const loadBtn = document.getElementById("loadBtn");
    const nsfwToggle = document.getElementById("nsfwToggle");
    const override = document.getElementById("override");

    let after = {};
    let liked = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    let history = [];

    function pickSubs() {
      if (override.value.startsWith("reddit=")) {
        return override.value.replace("reddit=","").split(",");
      }
      return Curated;
    }

    async function fetchBatch() {
      const subs = pickSubs();
      const sub = subs[Math.floor(Math.random()*subs.length)];
      const url = `https://www.reddit.com/r/${sub}/top.json?t=${TIME_RANGE}&limit=${BATCH}${after[sub]?`&after=${after[sub]}`:""}`;
      try {
        const r = await fetch(url);
        const j = await r.json();
        after[sub] = j.data.after;
        return j.data.children.map(c => c.data);
      } catch (e) {
        console.error("fetch error", e);
        return [];
      }
    }

    function chooseImage(post) {
      if (post.post_hint==="image" && post.url) return post.url;
      if (post.preview?.images?.[0]?.source?.url)
        return post.preview.images[0].source.url.replace(/&amp;/g,"&");
      return null;
    }

    function makeCard(post, img) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${img}" alt="">
        <div class="meta">
          <b>${post.title}</b><br>
          <small>by u/${post.author} • r/${post.subreddit}</small>
        </div>
        <div class="actions">
          <button class="like">⭐</button>
          <button class="undo hidden">↩ Undo</button>
        </div>
      `;
      const likeBtn = card.querySelector(".like");
      const undoBtn = card.querySelector(".undo");
      likeBtn.onclick = () => {
        liked.push({title: post.title, url: img});
        localStorage.setItem(STORAGE_KEY, JSON.stringify(liked));
        history.push(card);
        card.style.transform = "translateX(100%)";
        setTimeout(()=>card.remove(),300);
        undoBtn.classList.remove("hidden");
      };
      undoBtn.onclick = () => {
        if (history.length>0) {
          gallery.insertBefore(history.pop(), gallery.firstChild);
        }
      };
      return card;
    }

    async function loadMore() {
      status.textContent = "Loading...";
      let posts = await fetchBatch();
      let added = 0;
      for (let p of posts) {
        if (!nsfwToggle.checked && p.over_18) continue;
        const img = chooseImage(p);
        if (!img) continue;
        const card = makeCard(p,img);
        gallery.appendChild(card);
        added++;
      }
      status.textContent = added>0 ? `Loaded ${added} posts` : "No fresh image posts found.";
    }

    loadBtn.onclick = loadMore;
  </script>
</body>
</html>