<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scroll Wall — SFW models • influencers • actors (Reddit)</title>
  <style>
    :root{
      --bg:#0c0f16;
      --bg2:#161d2a;
      --ink:#e6edf3;
      --muted:#97a2af;
      --accent:#ff6ea8;      /* button pink */
      --accent-ink:#181a1f;
      --panel:#212938;
      --ring:rgba(255,255,255,.12);
      --good:#3ddc97;
      --warn:#ffc83d;
      --bad:#ff5e57;

      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --polaroid:#11151f;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(80% 60% at 50% 0%, #1b2131 0%, transparent 60%),
        linear-gradient(#0c0f16, #0b0f15 40%, #0b0f14 100%);
      background-color:var(--bg);
    }

    .wrap{max-width:980px;margin:24px auto;padding:0 16px 80px}
    h1{font-size:40px;margin:8px 0 6px;letter-spacing:.5px}
    .sub{color:var(--muted);font-weight:600;margin:0 0 18px}

    .controls{
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
      border:1px solid var(--ring);
      border-radius:var(--radius);
      padding:18px;
      display:grid;
      grid-template-columns:auto auto 1fr;
      gap:14px 16px;
      align-items:center;
      box-shadow:var(--shadow);
    }
    .btn{
      border:0;
      border-radius:12px;
      background:var(--accent);
      color:var(--accent-ink);
      font-weight:800;
      padding:14px 18px;
      font-size:17px;
      letter-spacing:.2px;
      box-shadow:0 6px 16px rgba(255,110,168,.35);
    }
    .count{
      background:rgba(255,255,255,.07);
      padding:10px 14px;
      border-radius:12px;
      font-weight:800;
      min-width:64px;
      text-align:center;
    }
    .toggle{
      display:flex;align-items:center;gap:10px;font-weight:700;
      grid-column:1/-1;
    }
    .toggle input{width:22px;height:22px}
    .ovr{
      grid-column:1/-1;
      display:flex;align-items:center;gap:12px;
      border:1px solid var(--ring);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px 12px;
    }
    .ovr b{opacity:.8}
    .ovr input{
      flex:1;border:0;outline:0;background:transparent;color:var(--ink);
      font-size:16px
    }
    .note{margin-top:18px;color:var(--muted);font-weight:600}

    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:18px;
    }

    /* Polaroid-style card */
    .card{
      background:var(--panel);
      border-radius:18px;
      overflow:hidden;
      border:1px solid var(--ring);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
    }
    .polaroid{
      background:var(--polaroid);
      padding:10px 10px 16px;
      border-bottom:1px solid var(--ring);
    }
    .imgwrap{
      aspect-ratio: 4 / 3;
      overflow:hidden;border-radius:12px;
      background:#0a0d14;
      display:grid;place-items:center;
    }
    .imgwrap img{
      width:100%;height:100%;object-fit:cover;display:block
    }
    .meta{padding:12px 14px 10px;color:var(--muted);font-size:13px}
    .meta a{color:inherit;text-decoration:none}
    .title{padding:12px 14px 0;font-weight:800}
    .rate{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px 14px;border-top:1px solid var(--ring)
    }
    .stars button{
      background:none;border:0;font-size:18px;cursor:pointer;color:#667;
    }
    .stars button.on{color:#ffd86b; text-shadow:0 0 12px rgba(255,216,107,.5)}
    .scorepill{
      background:rgba(255,255,255,.06);padding:6px 10px;border-radius:999px;
      font-weight:800;color:#cde;
    }

    .error{
      margin:14px 0 0;
      border:1px solid rgba(255,99,99,.4);
      background:rgba(255,99,99,.08);
      padding:12px 14px;border-radius:12px;color:#ffd7d7;font-weight:700;
      white-space:pre-wrap
    }

    @media (max-width:540px){
      h1{font-size:32px}
      .controls{grid-template-columns:1fr auto}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Scroll Wall</h1>
    <p class="sub">SFW models • influencers • actors (Reddit). Rate with ⭐</p>

    <div class="controls">
      <button id="loadBtn" class="btn">Load more</button>
      <div id="count" class="count">0/0</div>

      <label class="toggle">
        <input id="nsfw" type="checkbox">
        <span>Allow NSFW</span>
      </label>

      <label class="ovr">
        <b>Override:&nbsp;</b>
        <input id="override" placeholder="e.g. reddit=r/FashionModels,r/ModelPhotography">
      </label>
    </div>

    <p class="note">Nothing yet — tap <b>Load more</b>.</p>
    <div id="err" class="error" style="display:none"></div>

    <div id="grid" class="grid"></div>
  </div>

<script>
(() => {
  // ---------- Config ----------
  const DEFAULT_SFW = [
    'FashionModels','ModelPhotography','CelebEvents','Celebs',
    'HighFashion','StreetFashion','Modelshoot','ArchitecturePorn' // a couple safe image-heavy fallbacks
  ];
  // You can include spicier subs when NSFW is ON, e.g.:
  const EXTRA_NSFW = [
    'CelebNSFW','NSFW_Snapchat','OnlyFansGirls101'
  ];

  // ---------- State ----------
  const grid = document.getElementById('grid');
  const loadBtn = document.getElementById('loadBtn');
  const countEl = document.getElementById('count');
  const nsfwEl = document.getElementById('nsfw');
  const overrideEl = document.getElementById('override');
  const errBox = document.getElementById('err');

  const afterMap = {};               // sub -> after cursor
  const seen = new Set();            // post ids shown
  const ratings = loadRatings();     // id -> 1..5
  let shown = 0;

  // ---------- Helpers ----------
  function loadRatings(){
    try { return JSON.parse(localStorage.getItem('scrollwall_ratings')||'{}'); }
    catch{ return {}; }
  }
  function saveRatings(){
    localStorage.setItem('scrollwall_ratings', JSON.stringify(ratings));
  }
  function setError(msg){
    errBox.style.display = 'block';
    errBox.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  }
  function clearError(){ errBox.style.display = 'none'; }

  function pickSubs(){
    const ov = (overrideEl.value || '').trim();
    const parsed = parseOverride(ov);
    if (parsed && parsed.type === 'reddit' && parsed.list.length){
      return parsed.list;
    }
    // default list depends on NSFW toggle
    return nsfwEl.checked ? [...DEFAULT_SFW, ...EXTRA_NSFW] : DEFAULT_SFW;
  }

  function parseOverride(s){
    // supports: reddit=r/sub1,r/sub2
    const m = /^reddit\s*=\s*(.+)$/i.exec(s);
    if(!m) return null;
    const parts = m[1]
      .split(',')
      .map(v => v.trim()
        .replace(/^r\//i,'')
        .replace(/^\/?r\//i,''))
      .filter(Boolean);
    return { type:'reddit', list: parts };
  }

  // Robust Reddit fetch that copes with galleries, preview links and i.redd.it
  async function fetchFromSub(sub, allowNSFW){
    const after = afterMap[sub] ? `&after=${encodeURIComponent(afterMap[sub])}` : '';
    const url = `https://api.reddit.com/r/${encodeURIComponent(sub)}/top?t=week&limit=60&raw_json=1${after}`;

    const res = await fetch(url, { headers: { 'Accept': 'application/json' }});
    if (!res.ok) throw new Error(`HTTP ${res.status} (${sub})`);
    const json = await res.json();
    afterMap[sub] = json?.data?.after || null;

    const items = [];
    for (const c of (json?.data?.children ?? [])) {
      const d = c.data; if (!d) continue;

      if (!allowNSFW && d.over_18) continue;

      let img = null;

      // 1) Gallery
      if (d.is_gallery && d.media_metadata) {
        const first = Object.values(d.media_metadata)[0];
        if (first) {
          const best = (first.p && first.p[first.p.length - 1]) || first.s;
          if (best && best.u) img = best.u.replace(/&amp;/g, '&');
        }
      }
      // 2) Preview
      if (!img && d.preview?.images?.[0]?.source?.url) {
        img = d.preview.images[0].source.url.replace(/&amp;/g, '&');
      }
      // 3) Direct / destination
      if (!img && d.url_overridden_by_dest) {
        const u = d.url_overridden_by_dest.replace(/&amp;/g, '&');
        if (/\.(jpe?g|png|gif|webp)(\?|$)/i.test(u) || /\/\/i\.redd\.it\//i.test(u)) {
          img = u;
        }
      }
      // 4) Fallback thumb
      if (!img && d.thumbnail && d.thumbnail.startsWith('http')) {
        img = d.thumbnail;
      }

      if (!img) continue;

      items.push({
        id: d.id,
        title: d.title,
        author: d.author,
        subreddit: d.subreddit,
        score: d.score,
        permalink: `https://reddit.com${d.permalink}`,
        image: img,
        over18: d.over_18
      });
    }
    return items;
  }

  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  function render(items){
    for (const it of items){
      if (seen.has(it.id)) continue;
      seen.add(it.id);
      shown++;

      const card = document.createElement('article');
      card.className = 'card';

      const up = document.createElement('div');
      up.className = 'polaroid';

      const imgwrap = document.createElement('div');
      imgwrap.className = 'imgwrap';
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.src = it.image;
      img.alt = it.title || 'image';
      imgwrap.appendChild(img);

      up.appendChild(imgwrap);
      card.appendChild(up);

      const title = document.createElement('div');
      title.className='title';
      title.textContent = it.title || '(untitled)';
      card.appendChild(title);

      const meta = document.createElement('div');
      meta.className='meta';
      meta.innerHTML = `by u/${it.author} in <a href="https://reddit.com/r/${it.subreddit}" target="_blank">r/${it.subreddit}</a>`;
      card.appendChild(meta);

      const rate = document.createElement('div');
      rate.className='rate';
      const stars = document.createElement('div');
      stars.className='stars';
      const saved = Number(ratings[it.id] || 0);
      const starBtns = [];
      for(let n=1;n<=5;n++){
        const b=document.createElement('button');
        b.textContent='★';
        if (saved>=n) b.classList.add('on');
        b.addEventListener('click',()=>{
          ratings[it.id]=n; saveRatings();
          starBtns.forEach((x,i)=>x.classList.toggle('on', i < n));
          pill.textContent = `${n}.0`;
        });
        stars.appendChild(b);
        starBtns.push(b);
      }
      const pill = document.createElement('div');
      pill.className='scorepill';
      pill.textContent = saved ? `${saved}.0` : '—';
      rate.appendChild(stars);
      rate.appendChild(pill);
      card.appendChild(rate);

      grid.appendChild(card);
    }
    countEl.textContent = `${shown}/${seen.size}`;
  }

  async function loadMore(){
    clearError();
    const subs = pickSubs();
    if (!subs.length) return;

    try{
      // fetch from a few subs in parallel, then render a mix
      const picks = shuffle([...subs]).slice(0, Math.min(4, subs.length));
      const results = await Promise.all(picks.map(s => fetchFromSub(s, nsfwEl.checked).catch(e => (setError(`Fetch ${s}: ${e.message}`), []))));
      const flat = shuffle(results.flat())
        .filter(it => !seen.has(it.id))
        .slice(0, 12);

      if (!flat.length){
        setError('No fresh image posts found. Try Load more again or different subs.');
      }else{
        render(flat);
      }
    }catch(err){
      setError(`Unexpected: ${err.message || err}`);
    }
  }

  // ---------- Wire up ----------
  loadBtn.addEventListener('click', loadMore);
  nsfwEl.addEventListener('change', ()=> {
    // changing this won’t clear what’s already rendered (keeps it simple)
  });

})();
</script>
</body>
</html>