<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scroll Wall</title>
<style>
  :root{
    --bg:#0e131a; --bg2:#121824; --ink:#e7ecf7; --muted:#9fb2d4;
    --accent:#ff6ea8; --accent2:#9df0d3; --panel:#1a2230; --chip:#263043;
    --like:#3ddc97; --nope:#ff6b6b; --shadow: 0 8px 24px rgba(0,0,0,.35);
    --radius:18px; --radius-lg:26px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
    color:var(--ink); background:
      radial-gradient(1400px 700px at 10% -10%, #1a2230 0%, #0e131a 55%) fixed,
      radial-gradient(1400px 700px at 110% 10%, #141a24 0%, #0e131a 50%) fixed,
      var(--bg);
    overscroll-behavior-y: none;
  }
  header{
    padding:26px 18px 12px; line-height:1;
  }
  h1{margin:0; font-size:48px; letter-spacing:.5px}
  .tagline{margin:8px 0 0; color:var(--muted); font-weight:600}
  .wrap{max-width:880px; margin:0 auto; padding:0 14px 80px}

  /* Controls */
  .controls{
    margin:12px 0 10px; background:linear-gradient(180deg,var(--panel),#121a27);
    border:1px solid #233046; border-radius:var(--radius-lg); padding:16px; box-shadow:var(--shadow)
  }
  .row{display:flex; flex-wrap:wrap; gap:14px; align-items:center}
  .pill{
    display:inline-flex; align-items:center; gap:12px; padding:16px 20px;
    border-radius:16px; background:var(--chip); color:var(--ink); border:1px solid #2c3a53;
    font-weight:800; letter-spacing:.2px; cursor:pointer; user-select:none;
  }
  .pill.primary{background:linear-gradient(180deg,#ff7fb7,#ff5a9f); border-color:#ff4a98; color:#1b0b14}
  .pill.secondary{background:linear-gradient(180deg,#2e3b54,#22314a)}
  .counter{min-width:84px; justify-content:center; font-variant-numeric: tabular-nums}
  .ghost{opacity:.9}
  .link{display:inline-flex; align-items:center; gap:8px; padding:12px 16px; border-radius:14px; background:#1c2636; border:1px solid #2d3a52; cursor:pointer}
  .spacer{flex:1}

  /* Grid */
  .grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px; margin-top:18px}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} }

  /* Card */
  .card{
    position:relative; border-radius:22px; overflow:hidden; background:#0b1017; border:1px solid #25334a;
    box-shadow: var(--shadow); touch-action:none; /* important for swipe, but we set only on the card */
  }
  .media{
    position:relative; width:100%; aspect-ratio: 4/5; background:#0f1722;
    display:flex; align-items:center; justify-content:center; overflow:hidden;
  }
  .media img, .media video{
    width:100%; height:100%; object-fit:cover; display:block;
  }
  .card .meta{
    padding:14px 14px 12px; background:linear-gradient(180deg,#121a20,#0e141c);
    border-top:1px solid #243248;
  }
  .title{font-size:18px; font-weight:800; margin:0 0 6px; text-shadow: 0 1px 0 rgba(0,0,0,.35)}
  .byline{font-size:13px; color:var(--muted); margin-bottom:10px}
  .chips{display:flex; gap:10px; flex-wrap:wrap}
  .chip{
    padding:8px 12px; border-radius:999px; background:#1d2738; border:1px solid #2c3a53; font-weight:700; font-size:12px; color:#cfe1ff
  }

  /* Like/Nope overlay + burst */
  .flag{
    position:absolute; top:16px; font-size:16px; font-weight:900; letter-spacing:1px; padding:8px 12px; border-radius:10px;
    background:rgba(0,0,0,.35); border:3px solid transparent; opacity:0; transform:scale(.9); pointer-events:none;
    text-shadow:0 1px 0 rgba(0,0,0,.6);
  }
  .flag.like{left:16px; border-color:var(--like); color:#e8fff8}
  .flag.nope{right:16px; border-color:var(--nope); color:#ffecec}

  .burst{position:absolute; inset:0; pointer-events:none; opacity:0}
  .burst::before, .burst::after{
    content:""; position:absolute; inset:auto; left:50%; top:50%; width:12px; height:12px; border-radius:50%;
    background:var(--like);
    transform:translate(-50%,-50%) scale(.1);
  }
  .burst.nope::before,.burst.nope::after{background:var(--nope)}

  @keyframes burst {
    0%{opacity:.9; transform:translate(-50%,-50%) scale(.1)}
    70%{opacity:.6}
    100%{opacity:0; transform:translate(-50%,-50%) scale(24)}
  }
  .burst.play::before{animation:burst .55s ease-out forwards}
  .burst.play::after{animation:burst .55s ease-out .05s forwards}

  /* Drag styles */
  .dragging{will-change: transform; box-shadow: 0 10px 40px rgba(0,0,0,.55)}
  .likeTint::after, .nopeTint::after{
    content:""; position:absolute; inset:0; background:linear-gradient(180deg,rgba(61,220,151,.22),rgba(61,220,151,0));
    mix-blend-mode:screen; pointer-events:none;
  }
  .nopeTint::after{background:linear-gradient(180deg,rgba(255,107,107,.25),rgba(255,107,107,0))}

  /* Liked sheet & Troublshoot */
  .sheet{
    position:fixed; inset:auto 0 0; max-height:70vh; background:var(--bg2); border-top:1px solid #2b3a52; border-radius:18px 18px 0 0; transform:translateY(100%);
    transition:transform .3s ease; box-shadow: 0 -14px 30px rgba(0,0,0,.45); padding:16px; overflow:auto;
  }
  .sheet.open{transform:translateY(0)}
  .sheet h3{margin:0 0 10px}
  .sheet .mini{display:grid; grid-template-columns:repeat(3,1fr); gap:8px}
  .sheet .mini img{width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:10px; border:1px solid #26344c}

  pre.debug{
    background:#0b111a; border:1px solid #25334a; border-radius:14px; padding:14px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, Liberation Mono, monospace;
    color:#cfe1ff; font-size:13px; overflow:auto; box-shadow:var(--shadow)
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Scroll Wall</h1>
      <div class="tagline">Women ‚Ä¢ Models ‚Ä¢ Influencers ‚Ä¢ Actors (Reddit). Rate with ‚≠ê</div>
    </header>

    <!-- top controls -->
    <div class="controls">
      <div class="row">
        <button id="btnNew" class="pill secondary">New batch</button>
        <button id="btnLoad" class="pill primary">Load more</button>
        <div class="spacer"></div>
        <button id="btnLiked" class="pill secondary">Liked ‚≠ê</button>
      </div>
      <div class="row" style="margin-top:12px">
        <button id="btnShuffle" class="pill">Shuffle üîÄ</button>
        <div id="counter" class="pill counter">0/0</div>
        <button id="btnTrouble" class="pill">Troubleshoot ü©∫</button>
      </div>
    </div>

    <div id="tips" class="ghost" style="margin:10px 4px 0;color:var(--muted);font-weight:600">
      Tip: swipe a card ‚Äî right to like ‚≠ê, left to dismiss. Tap image to open post.
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>

    <div id="toast" style="position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#24151c;color:#ffdfe9;border:1px solid #3a2130;padding:10px 14px;border-radius:12px;display:none;font-weight:700">No fresh posts. Tap again.</div>

    <!-- Liked sheet -->
    <section id="likedSheet" class="sheet" aria-hidden="true">
      <div class="row">
        <h3 style="margin-right:auto">Liked ‚≠ê</h3>
        <button id="btnExport" class="pill">Export JSON</button>
        <button id="btnCloseLiked" class="pill">Close</button>
      </div>
      <div id="likedMini" class="mini" style="margin-top:12px"></div>
    </section>

    <!-- Troubleshoot sheet -->
    <section id="debugSheet" class="sheet" aria-hidden="true">
      <div class="row">
        <h3 style="margin-right:auto">Troubleshoot</h3>
        <button id="btnCloseDebug" class="pill">Close</button>
      </div>
      <pre id="debug" class="debug">Loading‚Ä¶</pre>
    </section>
  </div>

<script>
/* -------------------------- Curated sources -------------------------- */
/* 50 general (women/models/influencers/actresses) */
const GENERAL = [
  "FashionModels","InstagramModels","Celebs","ModelPhotography","HotModels","VSModels","Babes","Goddesses","LatinaCuties","PrettyGirls",
  "RunwayModels","AltGoneMild","ThickFit","BeachBabes","FitnessBeauties","StreetModels","PinUpGirls","CurveAngels","GirlsMirin","GirlsInBikinis",
  "CharliDAmelio","AddisonRae","LeaElui","MadisonBeer","SydneySweeney","MargotRobbie","ScarlettJohansson","Zendaya","LiliReinhart","HaileeSteinfeld",
  "SydneyMeyer","MadelynCline","FlorencePugh","AnyaTaylorJoy","SophieTurner","EmmaWatsonHQ","KaiaGerber","BarbaraPalvin","SaraSampaio","ElsaHosk",
  "AlexisRen","CamilaMorrone","LanaRhoadesHQ","SommerRay","NataliePortmanHQ","GalGadotHQ","AnaDeArmas","ElizabethOlsen","AlexandraDaddario","EmilyDidonato"
];

/* 50 appreciation (spicier ‚Äúmommy/HQ/HQ‚Äù style) */
const APPRECIATION = [
  "CharliDAmelioMommy","EmRataHQ","KendallJennerXXX","AddisonRaeHQ","LeaEluiHQ","MadisonBeerHQ","SydneySweeneyHQ","MargotRobbieMommy","ScarlettJohanssonHQ","AlexisRenHQ",
  "KylieJennerHQ","HaileyBieberHQ","ZendayaHQ","SabrinaCarpenterHQ","MadelynClineHQ","FlorencePughHQ","AnyaTaylorJoyHQ","MeganFoxHQ","GeorgiaGibbsHQ","HotInfluencersHQ",
  "TikTokBaddiesHQ","InstagramBaddies","CelebBaddies","InstaCelebs","VSBabesHQ","GoddessGallery","LatinaBaddies","ThickInfluencers","SoftBaddies","StunnerBabes",
  "GlamBaddies","PinupBeauties","BeachGoddesses","FitGoddesses","AltGoddesses","RunwayQueens","OnlyFansBeauties","OFQueens","BustyStunners","BrunetteBombshells",
  "BlondeBombshells","AsianHottiesHQ","EuroGoddesses","FrenchBaddies","ItalianGoddesses","BrazilianBaddies","ColombianBaddies","ArgentineBaddies","SpanishBaddies","CharliDAmelioHQ"
];

/* Combine & pre-shuffle for a batch */
function pickSources(count=16){
  // More weight to appreciation: 50%
  const half = Math.floor(count/2);
  const pick = (arr,n)=>shuffle([...arr]).slice(0,n);
  return shuffle([...pick(GENERAL,half), ...pick(APPRECIATION,count-half)]);
}

/* ----------------------------- Utilities ----------------------------- */
const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
const shuffle = (arr)=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
function $(sel,root=document){return root.querySelector(sel)}
function el(tag, cls){const e=document.createElement(tag); if(cls) e.className=cls; return e}
function toast(msg,ms=1800){const t=$("#toast"); t.textContent=msg; t.style.display="block"; clearTimeout(toast._); toast._=setTimeout(()=>t.style.display="none",ms)}
function setCounter(shown,total){$("#counter").textContent=`${shown}/${total}`}

/* ------------------------------ Fetching ----------------------------- */
let queue = [];           // posts in memory
let shown = 0;            // how many displayed this batch
let total = 0;            // total queued
let busy = false;         // prevents concurrent loads
let batchStamp = 0;       // change when "New batch"

async function fetchSubTop(sub){
  // top week, images/videos only signal
  const url=`https://www.reddit.com/r/${sub}/top.json?raw_json=1&t=week&limit=50`;
  const t0=performance.now();
  const res=await fetch(url,{headers:{'Accept':'application/json'}});
  const ms=Math.round(performance.now()-t0);
  if(!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText} for r/${sub} (${ms}ms)`);
  const js=await res.json();
  const arr=(js.data?.children||[]).map(c=>c.data);
  // map to lightweight objects
  return arr.map(d=>normalizeReddit(d,sub)).filter(Boolean);
}

function normalizeReddit(d,sub){
  // reject albums or text-only
  if(d.is_self) return null;
  // image url
  let image = d.url_overridden_by_dest || d.url || "";
  // turn gifv to mp4
  if(image.endsWith(".gifv")) image = image.replace(".gifv",".mp4");
  // prefer i.redd.it preview if exists
  const isImg = /\.(jpg|jpeg|png|webp)$/i.test(image);
  const isMP4 = /\.mp4$/i.test(image);
  // reddit hosted video
  let video = d.secure_media?.reddit_video?.fallback_url || d.media?.reddit_video?.fallback_url || null;
  // sometimes preview variants have mp4s for gifs
  if(!video && isMP4) video = image;

  if(!isImg && !video) return null;

  // SFW flag from Reddit
  const nsfw = d.over_18 === true;

  return {
    id: d.id, title: d.title || "Untitled", sub: sub || d.subreddit, author: d.author || "u/unknown",
    url: `https://www.reddit.com${d.permalink}`, image: isImg ? image : null, video: video,
    nsfw
  };
}

/* Build a new batch of posts from curated list */
async function newBatch(){
  if(busy) return;
  busy=true; batchStamp++; const stamp=batchStamp;
  queue=[]; shown=0; total=0; setCounter(0,0); $("#grid").innerHTML="";
  // pick 16 subs per batch
  const subs = pickSources(16);
  // fetch sequentially w/ gentle delay to avoid 429s
  for(const s of subs){
    try{
      const posts = await fetchSubTop(s);
      // randomize within sub, take first few
      queue.push(...shuffle(posts).slice(0,6));
      total = queue.length;
      setCounter(shown,total);
      await sleep(220); // backoff
    }catch(err){
      console.warn("Fetch fail", s, err);
    }
    // if user pressed New batch again, stop this run
    if(stamp!==batchStamp) break;
  }
  queue = shuffle(queue); // mix all subs together
  total = queue.length;
  setCounter(shown,total);
  if(total===0) toast("No fresh posts. Tap again.");
  busy=false;
}

/* Load N items into grid */
async function loadMore(n=6){
  if(busy) return;
  busy=true;
  const grid=$("#grid");
  let pushed=0;
  while(pushed<n && queue.length){
    const post=queue.shift();
    const card = makeCard(post);
    grid.appendChild(card);
    shown++; pushed++; setCounter(shown, total);
    await sleep(20);
  }
  if(pushed===0) toast("No fresh posts. Tap again.");
  busy=false;
}

/* --------------------------- Card + swipe ---------------------------- */
function makeCard(post){
  const card = el('article','card');
  const media = el('div','media');
  // Media element
  if(post.video){
    const v=document.createElement('video');
    v.src = post.video; v.autoplay=true; v.muted=true; v.playsInline=true; v.loop=true; v.controls=false;
    v.addEventListener('error',()=>{ media.textContent="(video failed)"; media.style.alignItems="center"; });
    media.appendChild(v);
  }else{
    const img = new Image();
    img.loading="lazy"; img.src=post.image;
    media.appendChild(img);
  }
  media.addEventListener('click',()=>window.open(post.url,'_blank'));
  card.appendChild(media);

  const likeFlag = el('div','flag like'); likeFlag.textContent="LIKE";
  const nopeFlag = el('div','flag nope'); nopeFlag.textContent="NOPE";
  const burst = el('div','burst'); const burstNo = el('div','burst nope');
  card.append(likeFlag,nopeFlag,burst,burstNo);

  const meta=el('div','meta');
  meta.innerHTML = `
    <h3 class="title">${escapeHTML(trunc(post.title,110))}</h3>
    <div class="byline">by u/${escapeHTML(post.author)} ‚Ä¢ r/${escapeHTML(post.sub)} ${post.nsfw?'<span class="chip" style="margin-left:8px;border-color:#6b2b3a;background:#3a1a23;color:#ffdfe5;">NSFW</span>':''}</div>
    <div class="chips">
      <a class="chip" href="${post.url}" target="_blank" rel="noopener">Reddit</a>
      ${post.image?'<span class="chip">Image</span>':''}
      ${post.video?'<span class="chip">Video</span>':''}
    </div>
  `;
  card.appendChild(meta);

  // Swipe
  enableSwipe(card, {
    onLike: ()=>saveLike(post, card),
    onNope: ()=>dismiss(card)
  });

  return card;
}

/* Minimal swipe handler that doesn‚Äôt fight page scroll */
function enableSwipe(node,{onLike,onNope}){
  let sx=0, sy=0, dx=0, dy=0, dragging=false;

  const start = (e)=>{
    const t=e.touches?e.touches[0]:e;
    sx=t.clientX; sy=t.clientY; dx=dy=0; dragging=true;
    node.classList.add('dragging');
  };
  const move = (e)=>{
    if(!dragging) return;
    const t=e.touches?e.touches[0]:e;
    dx=t.clientX-sx; dy=t.clientY-sy;
    // if horizontal dominates, prevent scroll and transform
    if(Math.abs(dx)>Math.abs(dy)){
      e.preventDefault();
      node.style.transform=`translate(${dx}px, ${dy*0.2}px) rotate(${dx*0.05}deg)`;
      if(dx>40){ node.classList.add('likeTint'); node.classList.remove('nopeTint'); node.querySelector('.flag.like').style.opacity=1; }
      else if(dx<-40){ node.classList.add('nopeTint'); node.classList.remove('likeTint'); node.querySelector('.flag.nope').style.opacity=1; }
      else{
        node.classList.remove('likeTint','nopeTint');
        node.querySelector('.flag.like').style.opacity=0;
        node.querySelector('.flag.nope').style.opacity=0;
      }
    }
  };
  const end = ()=>{
    if(!dragging) return;
    dragging=false;
    const liked = dx>120, noped = dx<-120;
    node.classList.remove('dragging');
    node.style.transition='transform .18s ease';
    if(liked){
      node.querySelector('.burst').classList.add('play');
      onLike&&onLike();
      node.style.transform='translate(140vw,-6px) rotate(12deg)';
      setTimeout(()=>node.remove(),180);
    }else if(noped){
      node.querySelector('.burst.nope').classList.add('play');
      onNope&&onNope();
      node.style.transform='translate(-140vw,6px) rotate(-12deg)';
      setTimeout(()=>node.remove(),180);
    }else{
      node.style.transform='translate(0,0) rotate(0)';
    }
    // cleanup
    setTimeout(()=>{
      node.style.transition='';
      node.classList.remove('likeTint','nopeTint');
      node.querySelector('.flag.like').style.opacity=0;
      node.querySelector('.flag.nope').style.opacity=0;
      node.querySelector('.burst').classList.remove('play');
      node.querySelector('.burst.nope').classList.remove('play');
    },220);
  };
  node.addEventListener('pointerdown',start,{passive:true});
  node.addEventListener('touchstart',start,{passive:true});
  node.addEventListener('pointermove',move,{passive:false});
  node.addEventListener('touchmove',move,{passive:false});
  node.addEventListener('pointerup',end);
  node.addEventListener('touchend',end);
}

/* ------------------------------ Likes ------------------------------- */
const LS_KEY='scrollwall.likes.v1';

function loadLikes(){
  try{return JSON.parse(localStorage.getItem(LS_KEY) || '[]')}catch{ return [] }
}
function saveLike(post, card){
  const likes=loadLikes();
  if(!likes.find(x=>x.id===post.id)) likes.unshift(post);
  localStorage.setItem(LS_KEY, JSON.stringify(likes));
  // tiny pulse on ‚≠ê count
  $("#btnLiked").animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:180});
}
function dismiss(card){ /* no-op placeholder; animations handled in swipe */ }

function openLiked(){
  const sheet=$("#likedSheet"); const list=$("#likedMini");
  const likes=loadLikes();
  list.innerHTML='';
  likes.forEach(p=>{
    const a=document.createElement('a');
    a.href=p.url; a.target='_blank'; a.rel='noopener';
    const img=new Image(); img.src=p.image || p.video || ''; img.alt=p.title; a.appendChild(img);
    list.appendChild(a);
  });
  sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false');
}
function closeLiked(){ const s=$("#likedSheet"); s.classList.remove('open'); s.setAttribute('aria-hidden','true') }

/* Export likes */
function exportLikes(){
  const blob=new Blob([JSON.stringify(loadLikes(),null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download='scrollwall_likes.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),2000);
}

/* --------------------------- Troubleshoot --------------------------- */
function openDebug(){
  const s=$("#debugSheet"); s.classList.add('open'); s.setAttribute('aria-hidden','false');
  const online = navigator.onLine;
  const ua = navigator.userAgent;
  const info = [
    `Online: ${online}`,
    `UA: ${ua}`,
    `Queue size: ${queue.length}`,
    `Shown: ${shown}/${total}`
  ];
  $("#debug").textContent = info.join('\n');
}
function closeDebug(){ const s=$("#debugSheet"); s.classList.remove('open'); s.setAttribute('aria-hidden','true') }

/* ------------------------------ Helpers ----------------------------- */
function escapeHTML(s){return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]))}
function trunc(s,n){ return s.length>n ? s.slice(0,n-1)+'‚Ä¶' : s }

/* ------------------------------ Events ------------------------------ */
$("#btnNew").addEventListener('click', newBatch);
$("#btnLoad").addEventListener('click', ()=>loadMore(8));
$("#btnShuffle").addEventListener('click', ()=>{
  queue = shuffle(queue);
  toast("Shuffled");
});
$("#btnLiked").addEventListener('click', openLiked);
$("#btnCloseLiked").addEventListener('click', closeLiked);
$("#btnExport").addEventListener('click', exportLikes);
$("#btnTrouble").addEventListener('click', openDebug);
$("#btnCloseDebug").addEventListener('click', closeDebug);

/* First batch on load */
newBatch();
</script>
</body>
</html>